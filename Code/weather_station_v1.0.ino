

// ----- BLYNK CREDENTIALS (Điền thông tin từ Blynk Console) -----
#define BLYNK_TEMPLATE_ID ""
#define BLYNK_TEMPLATE_NAME ""
#define BLYNK_AUTH_TOKEN ""

// ----- WIFI CREDENTIALS (Điền thông tin WiFi của bạn) -----
#define WIFI_SSID     ""    // Tên WiFi
#define WIFI_PASSWORD ""    // Mật khẩu WiFi

// ----- BLYNK VIRTUAL PINS (Theo datastream đã cấu hình) -----
#define VPIN_TEMPERATURE  V0  // Nhiệt độ (Integer, °C, -50 to 50)
#define VPIN_HUMIDITY     V1  // Độ ẩm (Integer, %, 0 to 100)
#define VPIN_RAIN_LEVEL   V2  // Mức mưa (Integer, %, 0 to 100)
#define VPIN_RAIN_STATUS  V3  // Trạng thái mưa (String)
#define VPIN_PRESSURE     V4  // Áp suất (Integer, hPa, 900 to 1100)
#define VPIN_DIGITAL      V5  // Digital (Integer, 0 or 1)
#define VPIN_DATA_ENABLE  V6  // Bật/Tắt gửi dữ liệu (Integer, 0=OFF, 1=ON)
#define VPIN_WIND_SPEED   V7  // Tốc độ gió (Double, km/h, 0 to 200)

// ----- BLYNK SETTINGS -----
#define BLYNK_PRINT Serial    // In debug log ra Serial Monitor
#define BLYNK_UPDATE_INTERVAL 2000   // Gửi dữ liệu mỗi 2s (milliseconds)

// ----- BACKEND SERVER (MongoDB) -----
#define BACKEND_SERVER_URL ""  // Thay bằng IP máy tính chạy backend
#define DEVICE_TOKEN ""  // Token xác thực từ MongoDB

/*
 * =====================================================================
 */

#include <WiFi.h>
#include <BlynkSimpleEsp32.h>
#include <Wire.h>
#include <Adafruit_GFX.h>
#include <Adafruit_SSD1306.h>
#include <Adafruit_BMP280.h>
#include <WebServer.h>
#include <LittleFS.h>
#include <ArduinoJson.h>
#include <HTTPClient.h>  // HTTP Client cho backend
#include <Update.h>  // OTA Update

#define SPIFFS LittleFS  // Alias để code cũ vẫn chạy

// ====================== FIRMWARE VERSION ======================
#define FIRMWARE_VERSION "v1.0"

// ====================== CẤU HÌNH ======================
#define SCREEN_WIDTH   128
#define SCREEN_HEIGHT   64
#define OLED_ADDR     0x3C

#define SDA_PIN 21
#define SCL_PIN 22

#define AHT20_ADDR 0x38

// Rain sensor
#define RAIN_AO 32  // GPIO 32 (ADC1 - hoạt động với WiFi)
#define RAIN_DO 2

// Wind speed sensor (Hall sensor A3144)
#define HALL_PIN 27  // GPIO 27 - Hall sensor để đo tốc độ gió

// Bật/tắt animation: 0 = tắt , 1 = bật 
#define USE_ANIM 1

// Kích thước frame animation 
#define FRAME_WIDTH  32
#define FRAME_HEIGHT 32

// Macro đếm phần tử mảng
#define COUNT_OF(arr) (sizeof(arr)/sizeof((arr)[0]))

// ====================== THIẾT BỊ ======================
Adafruit_SSD1306 display(SCREEN_WIDTH, SCREEN_HEIGHT, &Wire, -1);
Adafruit_BMP280   bmp280;
WebServer server(80);  // Web server on port 80

// ====================== BIẾN TRẠNG THÁI ======================
int currentPage = 0;
unsigned long lastPageChange = 0;
const unsigned long PAGE_INTERVAL = 4000;

float aht20_temp = 0;
float aht20_humidity = 0;
int   rain_analog = 0;
int   rain_digital = 0;
int   rain_level_percent = 0;
float pressure = 0;
float wind_speed = 0;  // Tốc độ gió (km/h)

String rain_status = "DRY";

// ===== Wind speed variables =====
volatile unsigned long wind_pulse_count = 0;  // Đếm số lần nam châm đi qua
unsigned long last_wind_calc_time = 0;
#define WIND_CALC_INTERVAL 2000  // Tính tốc độ gió mỗi 2 giây
#define WIND_MAGNETS 1          // Số nam châm trên quạt (1 nam châm = 1 xung/vòng)
#define WIND_RADIUS 0.024       // Bán kính từ tâm đến nam châm (mét) = 2.4cm

// ===== Blynk state =====
BlynkTimer blynkTimer;
unsigned long lastBlynkUpdate = 0;
bool blynkDataEnabled = true;  // Trạng thái gửi dữ liệu (mặc định: BẬT)
bool showPage3 = false;  // Flag để hiện trang 3 khi bấm nút
unsigned long page3ShowTime = 0;  // Thời điểm bắt đầu hiện trang 3
#define PAGE3_DISPLAY_DURATION 3000  // Hiện trang 3 trong 3 giây
bool blynkFirstSync = true;  // Flag để bỏ qua lần sync đầu tiên khi boot

// ===== Animation state =====
#define FRAME_DELAY 50  // 50ms mỗi frame = 20 FPS (mượt mà, không quá nhanh)
int tempAnimFrame = 0;
int humidityAnimFrame = 0;
int dataAnimFrame = 0;
unsigned long lastFrameUpdate = 0;

// ===== Sensor reading timing (non-blocking) =====
#define SENSOR_READ_INTERVAL 1000  // Đọc AHT20 mỗi 1 giây
unsigned long lastSensorRead = 0;
bool sensorReadInProgress = false;
unsigned long sensorTriggerTime = 0;

#define RAIN_READ_INTERVAL 200  // Đọc rain sensor mỗi 0.2 giây (nhanh để phát hiện mưa kịp thời)
unsigned long lastRainRead = 0;

// ====================== KHAI BÁO TRƯỚC (FORWARD DECLARATIONS) ======================
bool aht20_begin();
void aht20_read();
void detectRain(int analog, int digital, float humidity, float pressure);
void updateAnimationFrames();
const uint8_t* getTempFrame();
void displayPage1();
void displayPage2();
void displayPage3();
void setupSPIFFS();
void setupWebServer();
String getWeatherJSON();

// ====================== ANIMATION FRAMES ======================


#if USE_ANIM
//  COLD (Lạnh) - Snowflake animation 

const uint8_t PROGMEM coldFrames[][ (FRAME_WIDTH * FRAME_HEIGHT) / 8 ] = {
{0,0,3,0,0,0,3,0,0,0,7,0,0,32,59,112,0,32,27,96,0,32,7,160,3,44,7,160,0,248,27,96,0,240,59,112,1,248,7,0,3,38,3,0,0,32,3,0,0,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,0,0,0,45,0,0,0,31,0,0,0,30,0,0,0,63,0,0,0,12,0,0,16,4,0,0,28,0,0,0,56,0,8,0,8,0,8,12,0,0,126,7,0,0,28,14,0,0,126,30,0,0,8,2,0,0,8,0,0,0,0,0,0},
  {0,0,1,0,0,0,3,0,0,0,3,128,0,32,59,112,0,32,31,96,0,32,7,160,1,46,23,128,0,248,59,96,0,240,59,112,1,248,7,0,2,38,3,0,0,32,2,0,0,32,0,0,0,0,0,0,0,0,0,0,4,0,0,0,4,0,0,0,61,0,0,0,30,0,0,0,30,0,0,0,63,0,0,0,12,0,0,16,12,0,0,28,0,0,0,56,0,24,0,8,0,88,12,0,0,126,5,0,0,60,15,0,0,126,30,0,0,24,2,0,0,24,0,0,0,0,0,0},
  {0,0,1,0,0,0,3,0,0,0,11,128,0,48,25,112,0,48,31,112,3,32,7,160,0,166,55,128,0,120,59,224,0,112,58,96,3,184,7,64,0,38,3,0,0,32,2,0,0,32,0,0,0,0,0,0,0,0,0,0,4,0,0,0,4,0,0,0,63,0,0,0,30,0,0,0,62,0,0,0,47,0,0,0,8,0,0,16,0,0,0,24,0,0,0,60,0,24,0,56,0,88,8,0,0,62,12,0,0,56,15,0,0,124,28,0,0,16,4,0,0,16,0,0,0,0,0,0},
  {0,0,0,0,0,0,3,128,0,0,27,128,0,16,25,32,1,16,31,112,1,144,7,240,0,247,63,128,0,124,51,224,1,248,18,96,3,56,7,96,0,36,7,0,0,32,4,0,0,96,0,0,0,0,0,0,0,0,0,0,4,0,0,0,52,0,0,0,31,0,0,0,62,0,0,0,46,0,0,0,9,0,0,0,8,0,0,0,0,0,0,16,0,0,0,56,0,16,0,48,0,112,8,16,0,124,8,0,0,248,30,0,0,60,60,0,0,32,12,0,0,32,0,0,0,0,0,0},
  {0,0,0,0,0,0,1,128,0,0,29,192,0,12,29,128,0,136,7,48,0,88,55,240,0,57,63,48,0,127,51,128,1,248,6,224,0,40,14,224,0,36,6,0,0,98,0,0,0,0,0,0,0,0,0,0,6,0,0,0,20,0,0,0,28,0,0,0,31,0,0,0,60,0,0,0,10,0,0,0,24,0,0,0,0,0,0,0,0,0,0,0,0,16,0,48,0,208,0,120,0,112,8,48,0,124,24,0,1,240,62,0,0,104,60,0,0,64,8,0,0,0,8,0,0,0,0,0},
  {0,0,0,0,0,0,8,64,0,0,13,192,0,70,12,192,0,36,23,160,0,44,63,240,0,56,63,240,1,255,135,32,0,56,12,192,0,44,13,192,0,100,8,64,0,64,0,0,0,0,0,0,0,0,0,0,18,0,0,0,30,0,0,0,30,0,0,0,63,0,0,0,28,0,0,0,18,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,0,32,0,208,0,112,0,112,16,112,1,252,16,32,0,112,112,0,0,208,124,0,0,128,16,0,0,0,16,0,0,0,0,0},
  {0,0,0,0,0,0,6,0,0,0,14,224,0,17,6,224,0,19,51,128,0,30,63,160,0,252,55,240,0,31,135,48,0,56,157,128,0,108,29,192,0,68,1,128,0,4,0,0,0,0,0,0,0,0,0,0,10,0,0,0,62,0,0,0,63,0,0,0,29,0,0,0,52,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,144,0,0,0,240,0,160,3,224,0,240,0,248,16,112,1,224,112,64,1,32,120,0,0,0,40,0,0,0,32,0,0,0,0,0},
  {0,0,2,0,0,0,3,0,0,8,7,64,0,8,58,112,0,9,187,224,0,111,23,128,0,30,7,160,0,30,31,112,0,125,185,112,0,204,11,128,0,12,3,0,0,4,0,0,8,0,0,0,8,0,0,0,127,0,0,0,28,0,0,0,62,0,0,0,108,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,0,0,0,144,0,0,2,240,0,0,1,224,0,224,1,224,16,224,2,208,224,160,0,192,96,0,0,0,112,0,0,0,128,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,2,0,192,0,6,13,192,0,52,12,144,0,31,206,184,0,31,3,248,0,126,31,192,0,77,61,240,0,8,137,48,0,8,3,48,0,0,3,128,4,0,0,0,40,0,0,0,31,0,0,0,60,0,0,0,110,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,0,0,2,128,0,0,3,240,0,0,3,192,1,128,7,192,0,192,1,33,177,192,1,0,224,0,0,0,224,0,0,1,32,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,64,0,0,4,192,0,0,6,128,24,0,3,131,184,0,63,243,184,0,3,128,228,0,2,135,254,0,4,79,254,11,4,68,224,14,0,1,152,63,128,1,184,14,0,1,8,15,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,128,0,0,7,0,0,0,15,192,0,0,31,192,0,0,7,128,0,0,4,128,0,0,0,4,4,0,0,7,135,0,0,14,14,0,0,11,2,0,0,1,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,128,0,0,0,136,0,0,0,152,0,0,14,240,0,0,3,224,0,2,0,252,0,2,129,224,128,31,131,33,220,7,192,32,216,7,64,14,92,9,0,15,224,1,0,4,252,0,0,0,238,0,0,3,44,0,0,3,48,8,0,0,112,13,0,0,0,62,0,0,0,31,0,0,0,15,128,0,0,22,0,0,0,2,0,0,0,0,0,0,0,0,16,0,0,0,20,0,0,0,124,32,0,0,16,120,0,0,16,48,0,0,0,48,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,16,0,0,0,16,0,0,1,145,0,0,128,254,0,7,224,56,0,3,192,124,0,7,193,150,0,5,224,17,0,1,0,16,0,0,0,16,0,0,0,0,64,0,0,0,224,0,0,7,104,8,0,7,78,122,0,7,252,60,0,0,240,60,0,7,244,126,0,7,92,24,0,2,78,0,0,0,224,0,0,0,64,0,0,0,0,0,128,0,0,0,128,0,0,3,224,0,0,0,224,0,0,1,129,128,0,0,3,192,0,0,1,128,0,0,1,0,0},
  {0,0,0,0,0,0,0,0,0,36,0,0,0,28,0,0,0,31,0,0,0,124,0,0,0,30,12,64,0,18,6,192,0,0,3,128,36,0,3,248,60,0,31,192,29,0,1,192,126,0,3,96,28,0,2,32,22,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,96,0,0,7,112,36,0,7,96,60,0,1,200,28,0,13,252,18,0,31,200,16,0,12,224,0,0,1,56,0,64,3,176,1,192,1,136,0,224,0,0,0,160,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,128,16,0,0,176,22,0,0,224,28,0,3,240,126,0,0,248,30,0,1,224,44,0,0,32,4,0,0,0,0,0,0,0,0,0,108,0,0,0,56,0,0,128,56,0,0,152,104,0,0,240,0,0,7,224,0,0,1,248,0,0,0,236,0,0,1,160,0,0,3,32,120,0,0,48,48,0,128,0,112,1,220,0,0,1,216,0,0,2,220,0,0,14,112,0,0,7,254,0,0,0,238,0,0,3,164,0,0,3,184,0,0,3,176,0,0,0,16,0},
  {0,0,0,0,0,0,0,0,0,32,8,0,0,44,41,0,0,56,62,0,0,112,28,0,24,24,63,0,28,0,8,0,28,0,8,0,12,0,0,0,0,0,0,48,0,0,0,180,0,0,0,252,0,0,0,120,0,0,0,252,0,0,0,48,0,0,0,48,0,0,0,0,0,0,0,0,2,0,4,0,7,0,4,0,7,64,4,0,58,112,101,128,59,224,31,0,7,0,30,0,55,160,63,0,58,96,100,128,58,112,4,0,7,0,4,0,3,0,0,0,2,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,2,0,0,1,2,0,0,3,207,192,0,1,139,0,0,1,3,0,0,0,0,0,2,0,0,0,6,0,0,0,119,0,0,8,118,0,0,104,28,192,0,62,223,192,0,248,254,0,0,56,79,128,0,36,27,128,0,32,59,128,0,0,16,0,0,0,0,0,0,0,0,2,0,64,0,70,3,64,0,36,1,208,0,28,3,224,0,31,129,192,0,252,1,32,0,30,1,0,0,27,0,0,0,17,0,0,0,16,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,12,64,0,0,29,192,0,128,12,192,1,192,39,0,1,128,127,32,0,0,39,240,0,0,15,96,0,0,25,0,0,8,27,128,0,120,19,128,0,62,0,0,0,24,0,0,0,16,0,0,0,0,0,0,0,0,2,0,0,0,2,32,0,0,3,64,0,108,1,192,0,56,31,192,0,248,3,248,0,60,2,128,0,112,4,192,0,88,12,64,88,0,0,0,112,0,0,1,240,0,0,0,124,0,0,0,224,0,0,0,144,0,0,0,0,0,0,0,0,0},
  {0,48,0,0,0,116,0,0,3,39,0,0,3,190,0,0,3,120,0,0,0,122,0,0,3,247,0,0,3,183,0,4,0,56,0,28,0,48,0,28,0,0,0,16,0,0,0,0,2,0,0,0,2,0,0,0,34,96,0,0,63,192,0,52,15,0,0,28,15,128,0,28,26,192,0,18,50,0,0,0,2,0,0,0,2,0,0,0,0,0,1,128,0,0,5,160,0,4,7,192,0,63,3,192,0,30,7,224,0,31,4,128,0,53,0,128,0,4,0,0,0,0,0,0,0,0,0,0},
  {0,7,0,0,0,55,0,0,0,50,64,0,0,46,224,0,0,79,192,0,0,126,0,0,0,229,192,0,0,13,192,0,0,29,192,0,0,12,0,0,1,128,0,0,17,0,0,14,9,0,0,28,7,48,0,20,7,224,0,0,63,128,0,0,34,128,0,0,2,64,0,32,6,0,0,60,0,0,0,56,0,0,0,120,0,0,0,8,0,16,0,0,0,80,2,0,0,126,30,0,0,248,15,128,0,184,62,0,0,44,15,0,0,32,9,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,3,112,0,0,7,112,0,0,3,112,0,0,9,200,0,0,31,252,0,0,9,220,0,0,1,64,0,0,7,112,0,4,7,96,0,4,64,32,0,2,192,0,0,3,128,0,0,63,240,0,0,3,240,0,0,3,128,0,14,4,128,0,14,4,64,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,1,32,0,56,0,192,0,240,7,240,0,176,1,240,72,16,1,224,112,0,1,33,252,0,0,0,124,0,0,0,112,0,0,0,72,0,0,0,0,0,0,0,0,0},
  {0,0,112,0,0,0,119,0,0,3,166,0,0,3,248,0,0,1,121,0,0,0,127,0,1,1,211,128,1,17,216,0,1,48,60,0,29,224,8,0,7,192,0,0,3,240,0,0,6,152,0,0,12,128,0,0,0,128,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,15,2,0,0,6,2,128,0,4,31,128,0,0,7,128,0,64,7,192,0,64,9,0,1,240,1,1,33,224,0,5,224,64,0,7,192,0,0,1,240,0,0,2,128,0,0,0,128,0,0,0,0,0},
  {0,0,24,0,0,1,92,0,0,1,219,128,0,1,255,0,0,0,61,0,0,1,252,0,0,129,215,0,8,129,147,128,14,152,56,0,3,224,16,0,3,192,0,0,7,224,0,0,8,184,0,0,0,128,0,0,0,128,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,14,2,0,0,15,31,192,0,4,7,0,0,0,15,128,0,0,2,192,0,64,2,0,3,192,0,1,1,240,0,7,224,128,0,3,128,128,0,7,192,0,0,1,96,0,0,1,0,0,0,0,0,0},
  {0,0,14,0,0,0,238,0,0,0,100,0,0,0,61,192,0,0,159,128,0,1,252,128,4,97,222,0,2,64,19,0,3,192,59,0,1,248,56,0,15,192,0,0,0,224,0,0,1,176,0,0,1,16,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,6,10,0,0,28,7,192,0,14,31,0,0,8,7,0,0,0,5,128,0,64,4,0,2,192,0,13,1,192,0,7,1,224,0,7,193,0,0,15,128,0,0,2,128,0,0,2,0,0,0,0,0,0},
  {0,0,33,0,0,0,63,0,0,0,51,0,0,0,30,0,0,0,222,192,2,17,255,192,1,32,76,192,1,160,19,0,0,192,51,0,15,252,59,0,0,224,0,0,1,224,0,0,1,48,0,0,1,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,14,0,0,22,31,128,0,12,15,0,0,14,15,0,0,0,9,0,0,0,0,8,2,192,0,13,3,128,0,7,1,128,0,31,194,192,0,7,0,0,0,5,0,0,0,9,0,0,0,0,0,0},
  {0,0,16,0,0,0,29,128,0,0,25,128,0,0,109,128,0,0,238,0,1,136,127,192,0,144,14,224,0,240,58,64,7,224,51,0,0,252,55,0,0,228,1,0,1,32,0,0,3,32,0,0,0,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,15,0,0,0,30,0,0,0,31,128,0,28,14,0,0,12,26,0,0,28,2,0,0,0,0,8,4,128,0,13,7,128,0,14,3,0,0,31,7,128,0,15,132,128,0,26,0,0,0,2,0,0,0,0,0,0},
  {0,0,12,0,0,0,14,0,0,0,12,192,0,0,36,192,0,192,119,64,0,192,47,0,0,88,15,224,6,112,58,96,1,224,51,0,0,248,39,0,1,228,3,0,3,32,0,0,0,32,0,0,0,32,0,0,0,0,0,0,0,0,0,0,8,0,0,0,12,0,0,0,15,0,0,0,30,0,0,0,15,128,0,16,30,0,0,28,6,0,0,28,0,0,0,4,0,8,0,0,0,9,4,128,0,62,7,0,0,30,7,0,0,31,9,0,0,52,0,0,0,4,0,0,0,0,0,0},
  {0,0,6,0,0,0,7,0,0,0,6,96,0,0,114,96,0,64,59,224,0,64,47,0,2,76,7,224,3,248,58,96,0,240,58,96,0,248,7,0,3,38,3,0,2,32,0,0,0,32,0,0,0,32,0,0,0,0,0,0,0,0,0,0,12,0,0,0,13,0,0,0,63,0,0,0,14,0,0,0,31,0,0,0,20,0,0,28,4,0,0,28,0,0,0,28,0,8,0,0,0,8,4,0,0,62,7,0,0,28,14,0,0,63,11,0,0,40,0,0,0,12,0,0,0,0,0,0},
  {0,0,2,0,0,0,3,0,0,0,7,64,0,32,58,112,0,96,59,224,0,96,7,128,3,108,7,160,0,248,59,96,0,112,59,112,1,248,7,0,3,38,3,0,0,32,2,0,0,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,0,0,0,45,0,0,0,63,0,0,0,30,0,0,0,63,0,0,0,4,0,0,16,4,0,0,28,0,0,0,56,0,8,0,8,0,10,12,0,0,126,7,0,0,28,14,0,0,62,30,0,0,8,2,0,0,8,0,0,0,0,0,0}
};

// NORMAL (Bình thường)
const uint8_t PROGMEM normalFrames[][ (FRAME_WIDTH * FRAME_HEIGHT) / 8 ] = {
 {0,0,0,0,0,0,0,0,0,0,0,0,0,1,128,0,0,1,128,0,0,1,128,0,0,1,128,0,1,0,0,128,0,128,1,0,0,64,2,0,0,7,224,0,0,28,56,0,0,16,8,0,0,48,12,0,0,32,4,0,30,32,4,120,30,32,4,120,0,32,4,0,0,48,12,0,0,16,8,0,0,28,56,0,0,7,224,0,0,64,2,0,0,128,1,0,1,0,0,128,0,1,128,0,0,1,128,0,0,1,128,0,0,1,128,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,0,0,0,128,0,0,0,128,0,1,0,128,0,1,128,0,192,0,192,1,128,0,64,3,0,0,7,224,0,0,28,56,0,0,16,8,0,0,48,12,0,0,32,4,0,30,32,4,0,0,32,4,120,0,32,4,0,0,48,12,0,0,16,8,0,0,28,56,0,0,7,224,0,0,192,2,0,1,128,3,0,3,0,1,128,0,1,0,128,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,0,0,0,128,0,0,0,128,0,1,0,128,0,0,128,0,64,0,64,1,128,0,0,3,0,0,7,224,0,0,28,56,0,0,16,8,0,0,48,12,0,0,32,4,0,30,32,4,0,0,32,4,120,0,32,4,0,0,48,12,0,0,16,8,0,0,28,56,0,0,7,224,0,0,192,0,0,1,128,2,0,2,0,1,0,0,1,0,128,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,192,0,0,0,192,0,0,0,128,0,1,128,128,0,0,192,0,0,0,64,0,192,0,0,1,128,0,7,224,0,0,28,56,0,0,16,8,0,0,48,12,0,12,32,4,0,14,32,4,0,0,32,4,112,0,32,4,16,0,48,12,0,0,16,8,0,0,28,56,0,0,7,224,0,1,128,0,0,3,0,2,0,0,0,1,0,0,1,1,128,0,1,0,0,0,3,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,64,0,0,0,64,0,0,128,64,0,0,64,0,0,0,96,0,192,0,0,1,128,0,7,225,0,0,28,56,0,0,16,8,0,0,48,12,0,30,32,4,0,0,32,4,0,0,32,4,0,0,32,4,120,0,48,12,0,0,16,8,0,0,28,56,0,0,135,224,0,1,128,0,0,3,0,6,0,0,0,3,0,0,2,1,0,0,2,0,0,0,2,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,64,0,0,0,64,0,0,192,64,0,0,64,0,0,0,32,0,64,0,0,0,192,0,7,225,0,0,28,56,0,0,16,8,0,0,48,12,0,30,32,4,0,0,32,4,0,0,32,4,0,0,32,4,120,0,48,12,0,0,16,8,0,0,28,56,0,0,135,224,0,3,0,0,0,2,0,4,0,0,0,2,0,0,2,3,0,0,2,0,0,0,2,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,0,0,0,64,0,0,64,64,0,0,96,0,0,0,32,0,0,0,0,0,192,0,7,225,128,0,28,56,0,0,16,8,0,8,48,12,0,14,32,4,0,0,32,4,0,0,32,4,0,0,32,4,112,0,48,12,16,0,16,8,0,0,28,56,0,1,135,224,0,3,0,0,0,0,0,4,0,0,0,6,0,0,2,2,0,0,2,0,0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,96,0,0,64,96,0,0,32,0,0,0,0,0,0,0,0,0,96,0,7,224,128,0,28,56,0,0,16,8,0,12,48,12,0,6,32,4,0,0,32,4,0,0,32,4,0,0,32,4,96,0,48,12,48,0,16,8,0,0,28,56,0,1,7,224,0,6,0,0,0,0,0,0,0,0,0,4,0,0,6,2,0,0,6,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,32,0,0,96,32,0,0,32,0,0,0,0,0,0,0,0,0,96,0,7,224,192,0,28,56,0,0,16,8,0,14,48,12,0,0,32,4,0,0,32,4,0,0,32,4,0,0,32,4,0,0,48,12,112,0,16,8,0,0,28,56,0,3,7,224,0,6,0,0,0,0,0,0,0,0,0,4,0,0,4,6,0,0,4,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,32,0,0,32,32,0,0,32,0,0,0,0,0,0,0,0,0,0,0,7,224,192,0,28,56,0,0,16,8,0,6,48,12,0,0,32,4,0,0,32,4,0,0,32,4,0,0,32,4,0,0,48,12,112,0,16,8,0,0,28,56,0,3,7,224,0,0,0,0,0,0,0,0,0,0,0,4,0,0,4,4,0,0,4,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,0,0,32,48,0,0,32,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,224,96,0,28,56,0,12,16,8,0,6,48,12,0,0,32,4,0,0,32,4,0,0,32,4,0,0,32,4,0,0,48,12,96,0,16,8,48,0,28,56,0,6,7,224,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,0,0,12,4,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,16,0,0,48,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,224,32,0,28,56,64,14,16,8,0,0,48,12,0,0,32,4,0,0,32,4,0,0,32,4,0,0,32,4,0,0,48,12,0,0,16,8,48,2,28,56,0,4,7,224,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,0,0,8,4,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,16,0,0,16,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,224,0,0,28,56,64,6,16,8,0,0,48,12,0,0,32,4,0,0,32,4,0,0,32,4,0,0,32,4,0,0,48,12,0,0,16,8,96,2,28,56,0,0,7,224,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,0,0,8,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,24,0,0,16,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,224,0,4,28,56,96,6,16,8,0,0,48,12,0,0,32,4,0,0,32,4,0,0,32,4,0,0,32,4,0,0,48,12,0,0,16,8,96,6,28,56,32,0,7,224,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,0,0,24,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,8,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,224,0,4,28,56,32,0,16,8,0,0,48,12,0,0,32,4,0,0,32,4,0,0,32,4,0,0,32,4,0,0,48,12,0,0,16,8,0,4,28,56,32,0,7,224,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,16,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,8,0,0,8,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,224,0,6,28,56,0,0,16,8,96,0,48,12,0,0,32,4,0,0,32,4,0,0,32,4,0,0,32,4,0,0,48,12,0,6,16,8,0,4,28,56,96,0,7,224,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,16,0,0,16,24,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,0,0,8,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,224,0,2,28,56,0,0,16,8,96,0,48,12,0,0,32,4,0,0,32,4,0,0,32,4,0,0,32,4,0,0,48,12,0,6,16,8,0,0,28,56,64,0,7,224,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,16,0,0,16,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,4,0,0,0,12,0,0,0,0,0,0,0,0,0,0,0,0,0,6,7,224,0,3,28,56,0,0,16,8,112,0,48,12,0,0,32,4,0,0,32,4,0,0,32,4,0,0,32,4,0,0,48,12,0,12,16,8,0,0,28,56,64,0,7,224,32,0,0,0,0,0,0,0,0,0,0,0,0,0,48,16,0,0,32,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,12,4,0,0,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,6,7,224,0,0,28,56,0,0,16,8,48,0,48,12,64,0,32,4,0,0,32,4,0,0,32,4,0,0,32,4,0,2,48,12,0,12,16,8,0,0,28,56,0,0,7,224,96,0,0,0,0,0,0,0,0,0,0,0,0,0,32,32,0,0,32,48,0,0,0,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,0,0,0,4,0,0,0,4,4,0,0,0,4,0,0,0,0,0,0,0,0,0,3,7,224,0,0,28,56,0,0,16,8,0,0,48,12,112,0,32,4,0,0,32,4,0,0,32,4,0,0,32,4,0,14,48,12,0,0,16,8,0,0,28,56,0,0,7,224,192,0,0,0,0,0,0,0,0,0,32,0,0,0,32,32,0,0,0,32,0,0,0,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,4,2,0,0,4,6,0,0,0,4,0,0,0,0,0,2,0,0,0,3,7,224,0,0,28,56,0,0,16,8,0,0,48,12,112,0,32,4,0,0,32,4,0,0,32,4,0,0,32,4,0,14,48,12,0,0,16,8,0,0,28,56,0,0,7,224,192,0,0,0,96,0,0,0,0,0,32,0,0,0,96,32,0,0,0,32,0,0,0,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,4,0,0,0,2,2,0,0,0,4,0,0,0,0,0,2,0,0,0,1,7,224,0,0,28,56,0,0,16,8,0,0,48,12,48,0,32,4,64,0,32,4,0,0,32,4,0,2,32,4,0,12,48,12,0,0,16,8,0,0,28,56,0,0,7,224,128,0,0,0,64,0,0,0,0,0,32,0,0,0,64,64,0,0,0,32,0,0,0,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,0,0,0,2,0,0,0,2,2,0,0,0,6,0,0,0,4,0,3,0,0,0,1,135,224,0,0,28,56,0,0,16,8,0,0,48,12,0,0,32,4,112,0,32,4,0,0,32,4,0,14,32,4,0,0,48,12,0,0,16,8,0,0,28,56,0,0,7,225,128,0,0,0,192,0,32,0,0,0,96,0,0,0,64,64,0,0,0,64,0,0,0,96,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,2,0,0,0,2,3,0,0,0,2,0,2,0,4,0,1,0,0,0,0,135,224,0,0,28,56,0,0,16,8,0,0,48,12,0,0,32,4,120,0,32,4,0,0,32,4,0,30,32,4,0,0,48,12,0,0,16,8,0,0,28,56,0,0,7,225,0,0,0,0,128,0,32,0,64,0,64,0,0,0,192,64,0,0,0,64,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,1,0,0,0,3,0,2,0,6,0,1,128,0,0,0,135,224,0,0,28,56,0,0,16,8,0,0,48,12,0,0,32,4,120,0,32,4,0,0,32,4,0,30,32,4,0,0,48,12,0,0,16,8,0,0,28,56,0,0,7,225,0,0,0,1,128,0,96,0,64,0,192,0,0,0,128,64,0,0,0,64,0,0,0,64,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,3,0,0,0,1,0,0,0,1,1,128,0,0,3,0,3,0,2,0,0,128,0,0,0,7,224,0,0,28,56,0,0,16,8,0,0,48,12,0,0,32,4,24,0,32,4,112,14,32,4,0,8,32,4,0,0,48,12,0,0,16,8,0,0,28,56,0,0,7,224,0,0,0,1,128,0,64,0,192,0,192,0,64,1,128,128,0,0,0,128,0,0,0,192,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,128,2,0,1,0,1,0,3,0,0,192,0,0,0,7,224,0,0,28,56,0,0,16,8,0,0,48,12,0,0,32,4,0,0,32,4,120,30,32,4,0,0,32,4,0,0,48,12,0,0,16,8,0,0,28,56,0,0,7,224,0,0,0,1,0,0,192,0,128,0,128,0,64,1,0,128,0,0,0,128,0,0,0,128,0,0,0,128,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,128,3,0,1,128,1,128,3,0,0,192,2,0,0,7,224,0,0,28,56,0,0,16,8,0,0,48,12,0,0,32,4,0,0,32,4,120,30,32,4,0,0,32,4,0,0,48,12,0,0,16,8,0,0,28,56,0,0,7,224,0,0,64,3,0,0,192,1,128,1,128,0,192,1,0,128,0,0,0,128,0,0,0,128,0,0,0,128,0,0,0,0,0,0,0,0,0,0,0,0,0}
};

//  HOT (Nóng)
const uint8_t PROGMEM hotFrames[][ (FRAME_WIDTH * FRAME_HEIGHT) / 8 ] = {
  {0,2,0,0,0,7,0,0,0,5,128,0,0,4,96,0,0,8,48,0,0,8,24,0,0,24,4,0,0,16,6,0,0,32,3,0,0,96,1,128,0,192,128,192,0,128,192,64,1,0,224,32,2,0,144,32,6,0,136,16,4,0,136,16,8,0,132,24,8,16,132,8,16,57,134,8,16,39,6,8,16,64,6,8,16,64,6,8,16,64,4,8,16,96,4,8,16,32,12,8,24,48,8,16,8,0,0,16,4,0,0,32,6,0,0,96,3,0,0,192,0,224,1,128,0,56,2,0},
  {0,0,0,0,0,6,0,0,0,7,0,0,0,9,128,0,0,8,64,0,0,16,48,0,0,16,24,0,0,32,8,0,0,96,4,0,0,64,2,0,0,129,1,0,1,129,128,128,3,1,192,64,2,1,160,64,4,0,144,32,4,0,152,32,8,0,136,16,8,49,12,16,16,57,4,24,16,79,4,8,16,64,4,8,16,64,4,8,48,64,4,8,16,64,12,8,16,32,8,0,16,48,24,16,8,8,16,16,12,0,0,32,4,0,0,96,3,0,0,192,1,192,3,128,0,48,2,0},
  {0,0,0,0,0,0,0,0,0,24,0,0,0,28,0,0,0,50,0,0,0,33,128,0,0,96,192,0,0,64,32,0,0,128,16,0,1,128,8,0,1,0,6,0,3,6,3,0,2,3,1,128,4,3,128,128,12,2,64,64,8,2,32,96,24,2,16,32,16,98,24,32,16,118,8,48,48,204,8,16,32,192,12,16,32,128,12,16,32,192,12,16,32,64,8,16,48,96,24,16,16,48,16,48,16,8,16,32,8,0,0,32,12,0,0,64,6,0,0,128,1,192,3,0,0,112,4,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,112,0,0,0,76,0,0,0,134,0,0,1,129,0,0,1,0,192,0,3,0,32,0,2,0,24,0,6,8,12,0,4,12,2,0,8,14,1,0,8,13,129,128,24,4,192,128,16,12,96,64,48,140,48,64,32,248,16,32,32,128,8,32,32,128,8,32,32,128,8,32,96,128,8,32,32,192,24,32,32,96,16,32,32,56,48,32,48,8,32,96,16,0,0,64,8,0,0,192,6,0,1,128,3,192,3,0,0,240,4,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,96,0,0,0,208,0,0,0,140,0,0,1,6,0,0,3,1,128,0,2,0,192,0,6,0,48,0,4,16,8,0,8,24,4,0,24,28,3,0,16,11,1,0,16,9,128,128,48,8,64,192,32,152,32,64,32,240,16,64,33,128,24,96,97,0,8,32,97,0,8,32,64,128,8,32,96,128,24,32,32,64,16,32,32,56,48,32,32,12,32,96,16,0,0,64,8,0,0,192,12,0,1,128,3,128,7,0,0,224,4,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,48,0,0,0,104,0,0,0,70,0,0,0,195,0,0,0,128,128,0,1,128,96,0,1,0,48,0,2,0,8,0,6,8,4,0,4,14,2,0,12,7,1,0,8,4,128,128,24,4,64,192,16,4,32,64,16,68,16,32,48,248,24,32,32,128,8,32,32,128,8,32,32,128,8,48,32,128,8,48,32,192,8,48,32,96,24,32,32,56,16,32,48,8,32,32,24,0,0,96,8,0,0,192,6,0,1,128,3,192,3,0,0,240,4,0},
  {0,0,0,0,0,12,0,0,0,14,0,0,0,9,0,0,0,16,192,0,0,16,96,0,0,48,48,0,0,32,24,0,0,64,12,0,0,192,2,0,0,128,3,0,1,1,129,128,3,1,192,128,2,1,96,64,4,1,32,32,12,1,16,32,8,1,24,16,16,33,8,16,16,59,12,16,16,78,4,24,16,64,4,8,32,64,4,8,48,64,4,8,48,64,8,24,16,32,8,16,16,48,24,16,24,8,16,16,8,0,0,32,4,0,0,96,3,0,0,192,1,192,3,128,0,48,2,0},
  {0,2,0,0,0,7,0,0,0,5,128,0,0,4,96,0,0,8,48,0,0,8,24,0,0,24,4,0,0,16,6,0,0,32,3,0,0,96,1,128,0,192,128,192,0,128,192,64,1,0,224,32,2,0,144,32,6,0,136,16,4,0,136,16,8,0,132,24,8,16,132,8,16,57,134,8,16,39,6,8,16,64,6,8,16,64,6,8,16,64,4,8,16,96,4,8,16,32,12,8,24,48,8,16,8,0,0,16,4,0,0,32,6,0,0,96,3,0,0,192,0,224,1,128,0,56,2,0},
  {0,0,0,0,0,1,0,0,0,1,128,0,0,2,96,0,0,2,48,0,0,4,8,0,0,4,4,0,0,8,2,0,0,24,1,0,0,48,0,128,0,96,0,64,0,64,96,64,0,128,112,32,1,0,112,48,3,0,104,16,2,0,108,24,4,0,100,8,4,8,68,8,8,28,66,8,8,19,130,8,24,48,2,12,16,32,2,12,16,32,6,8,24,32,4,8,24,48,12,8,8,24,24,24,8,8,16,16,4,0,0,48,2,0,0,96,3,0,0,192,0,224,1,128,0,56,2,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,0,0,0,216,0,0,0,140,0,0,1,2,0,0,3,1,0,0,2,0,128,0,4,0,64,0,8,0,96,0,16,0,48,0,32,8,16,0,96,8,24,0,192,12,8,1,128,12,8,3,0,10,12,2,0,18,4,6,3,18,4,4,7,227,4,12,12,3,4,12,8,3,4,8,8,2,4,8,8,2,4,8,8,4,12,4,4,12,8,4,4,16,24,6,0,0,16,2,0,0,32,1,128,0,64,0,240,1,128,0,60,2,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,56,0,0,0,100,0,0,0,66,0,0,0,129,128,0,1,128,192,0,3,0,96,0,6,0,32,0,12,0,16,0,24,4,24,0,48,4,8,0,96,6,8,0,192,6,4,1,128,7,4,3,0,13,4,2,0,137,4,6,1,249,4,4,6,1,4,4,4,1,4,4,4,1,4,4,4,1,4,4,4,2,4,4,4,6,12,4,2,56,8,6,0,0,16,3,0,0,48,1,128,0,96,0,240,1,128,0,60,2,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,0,0,0,88,0,0,0,204,0,0,0,130,0,0,1,1,0,0,3,0,128,0,6,0,64,0,12,0,32,0,24,0,48,0,48,8,16,0,96,12,8,0,192,12,8,1,128,14,8,1,0,10,4,2,0,11,4,6,1,19,4,4,3,241,4,4,6,1,4,4,12,1,4,12,8,1,4,8,8,2,4,12,8,6,12,4,4,12,8,4,4,24,24,6,0,0,16,3,0,0,32,1,128,0,64,0,240,1,128,0,60,2,0},
  {0,0,0,0,0,0,0,0,0,0,192,0,0,1,224,0,0,1,16,0,0,3,12,0,0,2,6,0,0,6,3,0,0,12,1,128,0,24,0,128,0,16,0,64,0,32,0,32,0,64,48,32,0,128,56,16,1,128,24,16,3,0,20,8,2,0,52,8,4,0,38,8,4,6,34,8,12,13,194,4,8,24,2,4,8,16,2,4,8,16,2,12,8,16,4,12,8,16,12,8,8,8,24,8,12,4,16,16,4,0,0,48,2,0,0,96,1,128,0,192,0,240,1,128,0,56,2,0},
  {0,0,0,0,0,3,0,0,0,2,128,0,0,2,96,0,0,4,48,0,0,4,24,0,0,8,4,0,0,24,2,0,0,16,1,0,0,32,0,128,0,96,64,192,0,192,64,64,1,128,96,32,1,0,112,32,2,0,72,16,6,0,76,16,4,0,68,8,8,8,70,8,8,28,134,8,16,55,130,8,16,32,2,12,16,32,6,8,16,32,4,8,16,32,4,8,24,48,12,8,8,16,8,16,8,8,16,16,4,0,0,32,2,0,0,96,3,0,0,192,0,224,1,128,0,56,2,0},
  {0,2,0,0,0,7,0,0,0,5,128,0,0,4,96,0,0,8,48,0,0,8,24,0,0,24,4,0,0,16,6,0,0,32,3,0,0,96,1,128,0,192,128,192,0,128,192,64,1,0,224,32,2,0,144,32,6,0,136,16,4,0,136,16,8,0,132,24,8,16,132,8,16,57,134,8,16,39,6,8,16,64,6,8,16,64,6,8,16,64,4,8,16,96,4,8,16,32,12,8,24,48,8,16,8,0,0,16,4,0,0,32,6,0,0,96,3,0,0,192,0,224,1,128,0,56,2,0},
  {0,4,0,0,0,6,0,0,0,5,0,0,0,8,192,0,0,8,96,0,0,16,48,0,0,16,8,0,0,32,4,0,0,96,2,0,0,64,3,0,0,129,1,128,1,129,192,128,3,1,224,64,2,0,160,96,4,0,144,32,4,0,152,16,8,0,136,16,8,48,140,24,16,57,4,24,16,79,4,8,16,64,4,8,16,64,4,8,48,64,4,8,16,64,12,8,16,32,8,24,16,48,8,16,8,8,16,16,12,0,0,32,4,0,0,96,3,0,0,192,1,192,1,128,0,48,2,0},
  {0,0,0,0,0,8,0,0,0,28,0,0,0,18,0,0,0,33,128,0,0,32,192,0,0,96,96,0,0,64,16,0,0,128,8,0,1,128,4,0,1,2,2,0,2,3,1,0,6,3,128,128,4,2,192,64,8,3,96,64,8,3,32,32,16,2,16,48,16,98,24,16,16,118,8,16,32,92,12,24,32,192,12,24,32,192,12,8,32,192,12,24,32,64,8,16,48,96,8,16,16,48,16,16,16,24,16,16,8,0,0,32,4,0,0,96,3,0,0,192,1,192,3,128,0,48,2,0},
  {0,0,0,0,0,0,0,0,0,48,0,0,0,120,0,0,0,76,0,0,0,130,0,0,0,129,128,0,1,0,192,0,3,0,32,0,2,0,16,0,6,8,12,0,4,12,6,0,8,14,3,0,8,5,1,128,16,4,128,128,16,4,64,64,48,4,32,96,32,204,16,32,32,248,24,32,32,128,8,16,32,128,8,16,32,128,8,16,96,128,8,16,32,192,8,16,32,64,24,16,32,48,16,48,16,8,16,32,24,0,0,96,12,0,0,64,6,0,0,128,1,192,3,0,0,112,4,0},
  {0,0,0,0,0,0,0,0,0,128,0,0,0,192,0,0,1,32,0,0,3,24,0,0,2,12,0,0,6,3,0,0,4,1,128,0,8,0,96,0,24,0,48,0,16,48,8,0,48,56,6,0,32,28,3,0,32,19,1,128,32,17,128,128,96,16,64,64,67,176,32,64,67,224,48,32,65,0,16,32,65,0,24,32,65,0,8,32,65,128,8,32,64,128,24,32,96,64,16,32,32,48,48,32,32,24,32,96,16,0,0,64,8,0,0,192,4,0,1,128,3,192,3,0,0,240,4,0},
  {0,0,0,0,0,0,0,0,0,56,0,0,0,44,0,0,0,102,0,0,0,65,0,0,0,128,128,0,1,128,96,0,1,0,48,0,3,0,8,0,2,0,4,0,6,6,2,0,4,7,1,0,8,5,128,128,8,4,192,192,16,6,96,64,16,4,48,32,48,196,16,32,32,252,8,16,32,128,8,16,32,128,8,16,32,128,8,16,32,128,8,16,32,192,8,16,32,96,24,16,48,48,16,48,16,8,16,32,8,0,0,32,12,0,0,64,6,0,0,128,1,192,3,0,0,112,6,0},
  {0,0,0,0,0,12,0,0,0,11,0,0,0,9,128,0,0,16,192,0,0,16,32,0,0,32,16,0,0,32,8,0,0,64,4,0,0,192,2,0,0,129,1,0,1,1,128,128,2,1,192,192,6,1,96,64,4,1,48,32,8,1,16,32,8,1,8,16,16,33,12,16,16,59,4,24,16,78,4,24,16,64,4,8,32,64,4,8,48,64,4,8,16,64,12,8,16,32,8,0,16,48,24,16,8,8,16,16,8,0,0,32,4,0,0,96,3,0,0,192,1,192,3,128,0,48,2,0},
  {0,2,0,0,0,7,0,0,0,5,128,0,0,4,96,0,0,8,48,0,0,8,24,0,0,24,4,0,0,16,6,0,0,32,3,0,0,96,1,128,0,192,128,192,0,128,192,64,1,0,224,32,2,0,144,32,6,0,136,16,4,0,136,16,8,0,132,24,8,16,132,8,16,57,134,8,16,39,6,8,16,64,6,8,16,64,6,8,16,64,4,8,16,96,4,8,16,32,12,8,24,48,8,16,8,0,0,16,4,0,0,32,6,0,0,96,3,0,0,192,0,224,1,128,0,56,2,0},
  {0,0,0,0,0,1,0,0,0,1,192,0,0,3,96,0,0,2,48,0,0,6,12,0,0,4,4,0,0,8,2,0,0,24,1,0,0,48,0,128,0,32,0,64,0,64,96,32,0,192,48,32,1,128,48,16,1,0,40,16,2,0,36,8,6,0,36,8,4,12,36,8,8,30,66,12,8,19,194,12,8,48,2,4,8,48,2,4,8,48,6,4,8,48,4,8,8,16,12,8,8,24,8,8,4,8,16,16,4,0,0,48,2,0,0,96,1,128,0,192,0,224,1,128,0,56,2,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,0,0,0,88,0,0,0,196,0,0,0,130,0,0,1,129,128,0,3,0,128,0,6,0,64,0,12,0,32,0,24,0,16,0,48,8,16,0,96,12,8,0,64,6,8,0,128,6,12,1,128,5,4,1,1,137,4,3,3,217,4,2,6,113,6,2,4,1,2,6,8,1,2,4,8,1,6,4,8,3,6,6,12,2,4,2,4,12,4,2,4,24,8,3,0,0,24,1,0,0,48,0,128,0,96,0,112,1,128,0,28,2,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,0,0,0,54,0,0,0,35,0,0,0,64,128,0,0,192,64,0,1,128,96,0,3,0,48,0,6,0,16,0,8,0,8,0,16,2,8,0,32,3,4,0,64,3,132,0,128,3,134,0,128,194,130,1,1,188,130,1,3,24,130,1,6,0,194,3,6,0,130,2,4,0,130,2,4,1,130,2,4,1,2,2,4,3,4,3,2,60,12,1,0,0,24,1,128,0,48,0,192,0,96,0,48,1,192,0,28,2,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,0,0,0,56,0,0,0,100,0,0,0,67,0,0,0,129,128,0,1,0,192,0,3,0,64,0,6,0,32,0,12,0,16,0,24,4,24,0,48,6,8,0,96,6,12,0,192,7,4,0,128,7,4,1,1,133,132,1,3,253,134,3,6,56,130,2,4,0,130,2,4,0,130,2,12,1,2,2,12,1,6,2,4,3,6,2,4,6,4,2,4,24,8,1,0,0,24,1,128,0,48,0,192,0,96,0,112,1,128,0,28,2,0},
  {0,0,0,0,0,0,0,0,0,0,192,0,0,0,224,0,0,1,152,0,0,1,12,0,0,3,2,0,0,6,1,0,0,4,0,128,0,8,0,192,0,24,0,96,0,48,16,32,0,96,24,16,0,192,24,16,0,128,28,8,1,0,22,8,3,0,18,12,2,6,18,4,6,7,51,4,4,8,227,4,4,8,3,4,12,24,2,4,12,16,2,4,4,16,2,4,4,24,4,4,4,8,28,8,4,4,16,24,2,0,0,16,3,0,0,32,1,128,0,64,0,112,1,128,0,56,2,0},
  {0,0,0,0,0,3,0,0,0,3,192,0,0,2,96,0,0,4,48,0,0,4,8,0,0,8,4,0,0,8,2,0,0,16,1,0,0,32,0,128,0,96,64,64,0,192,96,64,0,128,112,32,1,0,80,48,2,0,72,16,6,0,76,24,4,0,68,8,8,8,68,8,8,28,194,8,8,51,130,12,24,32,2,12,16,32,2,4,16,32,6,8,24,32,4,8,8,48,12,8,8,24,8,24,8,8,16,16,4,0,0,48,2,0,0,96,3,0,0,192,0,224,1,128,0,56,2,0}
};

// =====  HUMIDITY (Độ ẩm) =====

const uint8_t PROGMEM humidityFrames[][ (FRAME_WIDTH * FRAME_HEIGHT) / 8 ] = {
{0,3,192,0,0,6,96,0,0,12,48,0,0,8,16,0,0,8,16,0,0,12,48,0,0,15,252,0,0,12,48,0,0,8,60,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,48,0,0,24,24,0,0,48,12,0,0,96,6,0,0,64,2,0,0,64,2,0,0,64,3,0,0,192,3,0,0,64,2,0,0,64,2,0,0,64,2,0,0,32,4,0,0,16,8,0,0,12,112,0,0,3,192,0},
  {0,3,192,0,0,6,96,0,0,12,48,0,0,8,16,0,0,8,16,0,0,12,48,0,0,15,252,0,0,12,48,0,0,8,60,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,48,0,0,24,24,0,0,48,12,0,0,96,6,0,0,64,2,0,0,64,2,0,0,64,3,0,0,192,3,0,0,64,2,0,0,64,2,0,0,64,2,0,0,32,4,0,0,16,8,0,0,12,112,0,0,3,192,0},
  {0,3,192,0,0,6,96,0,0,12,48,0,0,8,16,0,0,8,16,0,0,12,48,0,0,15,252,0,0,12,48,0,0,8,60,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,48,0,0,24,24,0,0,48,12,0,0,96,6,0,0,64,2,0,0,64,2,0,0,64,3,0,0,192,3,0,0,64,2,0,0,64,2,0,0,64,2,0,0,32,4,0,0,16,8,0,0,12,112,0,0,3,192,0},
  {0,3,192,0,0,6,96,0,0,12,48,0,0,8,16,0,0,8,16,0,0,12,48,0,0,15,252,0,0,8,16,0,0,8,60,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,48,0,0,24,24,0,0,48,12,0,0,96,6,0,0,64,2,0,0,64,2,0,0,64,3,0,0,192,3,0,0,64,2,0,0,64,2,0,0,64,2,0,0,32,4,0,0,16,8,0,0,12,112,0,0,3,192,0},
  {0,3,192,0,0,6,96,0,0,8,48,0,0,8,48,0,0,8,48,0,0,15,240,0,0,12,60,0,0,8,48,0,0,8,60,0,0,8,60,0,0,8,48,0,0,8,60,0,0,8,48,0,0,8,60,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,16,0,0,24,24,0,0,48,12,0,0,32,6,0,0,64,2,0,0,64,3,0,0,64,3,0,0,64,1,0,0,64,2,0,0,64,2,0,0,64,2,0,0,32,4,0,0,16,12,0,0,12,112,0,0,3,224,0},
  {0,7,192,0,0,14,96,0,0,8,32,0,0,8,32,0,0,9,160,0,0,15,240,0,0,8,60,0,0,8,48,0,0,8,60,0,0,8,48,0,0,8,48,0,0,8,60,0,0,8,48,0,0,8,60,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,16,0,0,24,24,0,0,48,4,0,0,32,2,0,0,64,2,0,0,64,3,0,0,64,1,0,0,64,1,0,0,64,1,0,0,64,2,0,0,96,2,0,0,32,4,0,0,24,12,0,0,14,112,0,0,3,224,0},
  {0,7,192,0,0,14,96,0,0,8,32,0,0,8,32,0,0,11,224,0,0,12,48,0,0,8,60,0,0,8,32,0,0,8,60,0,0,8,48,0,0,8,48,0,0,8,60,0,0,8,48,0,0,8,60,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,16,0,0,24,24,0,0,48,4,0,0,32,2,0,0,64,2,0,0,64,3,0,0,64,1,0,0,64,1,0,0,64,1,0,0,64,2,0,0,96,2,0,0,32,4,0,0,24,12,0,0,14,56,0,0,3,224,0},
  {0,7,192,0,0,14,96,0,0,8,32,0,0,8,32,0,0,8,32,0,0,8,48,0,0,8,60,0,0,8,48,0,0,15,252,0,0,8,48,0,0,8,48,0,0,8,60,0,0,8,48,0,0,8,60,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,16,0,0,24,24,0,0,48,4,0,0,32,2,0,0,64,2,0,0,64,3,0,0,64,1,0,0,64,1,0,0,64,1,0,0,64,2,0,0,96,2,0,0,32,4,0,0,24,12,0,0,14,112,0,0,3,224,0},
  {0,3,192,0,0,6,96,0,0,8,48,0,0,8,48,0,0,8,48,0,0,8,48,0,0,8,60,0,0,8,48,0,0,8,60,0,0,8,60,0,0,8,48,0,0,8,60,0,0,8,48,0,0,8,60,0,0,14,60,0,0,15,176,0,0,8,60,0,0,8,16,0,0,24,24,0,0,48,12,0,0,32,6,0,0,64,2,0,0,64,3,0,0,64,3,0,0,64,1,0,0,64,2,0,0,64,2,0,0,64,2,0,0,32,4,0,0,16,12,0,0,12,112,0,0,3,224,0},
  {0,3,192,0,0,6,96,0,0,12,48,0,0,8,16,0,0,8,16,0,0,8,48,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,60,0,0,8,16,0,0,8,60,0,0,12,48,0,0,30,120,0,0,51,140,0,0,96,6,0,0,64,2,0,0,64,2,0,0,64,3,0,0,192,3,0,0,64,2,0,0,64,2,0,0,64,2,0,0,32,4,0,0,16,8,0,0,12,112,0,0,3,192,0},
  {0,3,192,0,0,6,96,0,0,12,48,0,0,8,16,0,0,8,16,0,0,8,48,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,60,0,0,8,16,0,0,8,60,0,0,12,48,0,0,31,248,0,0,48,12,0,0,96,6,0,0,64,2,0,0,64,2,0,0,64,3,0,0,192,3,0,0,64,2,0,0,64,2,0,0,64,2,0,0,32,4,0,0,16,8,0,0,12,112,0,0,3,192,0},
  {0,3,192,0,0,6,96,0,0,12,48,0,0,8,16,0,0,8,16,0,0,8,48,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,60,0,0,8,16,0,0,12,60,0,0,15,240,0,0,24,24,0,0,48,12,0,0,96,6,0,0,64,2,0,0,64,2,0,0,64,3,0,0,192,3,0,0,64,2,0,0,64,2,0,0,64,2,0,0,32,4,0,0,16,8,0,0,12,112,0,0,3,192,0},
  {0,3,192,0,0,6,96,0,0,12,48,0,0,8,16,0,0,8,16,0,0,8,48,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,60,0,0,8,16,0,0,15,252,0,0,15,176,0,0,24,24,0,0,48,12,0,0,96,6,0,0,64,2,0,0,64,2,0,0,64,3,0,0,192,3,0,0,64,2,0,0,64,2,0,0,64,2,0,0,32,4,0,0,16,8,0,0,12,112,0,0,3,192,0},
  {0,3,192,0,0,6,96,0,0,12,48,0,0,8,16,0,0,8,16,0,0,8,48,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,60,0,0,8,16,0,0,15,252,0,0,12,48,0,0,24,24,0,0,48,12,0,0,96,6,0,0,64,2,0,0,64,2,0,0,64,3,0,0,192,3,0,0,64,2,0,0,64,2,0,0,64,2,0,0,32,4,0,0,16,8,0,0,12,112,0,0,3,192,0},
  {0,3,192,0,0,6,96,0,0,12,48,0,0,8,16,0,0,8,16,0,0,8,48,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,60,0,0,8,16,0,0,15,252,0,0,12,48,0,0,24,24,0,0,48,12,0,0,96,6,0,0,64,2,0,0,64,2,0,0,64,3,0,0,192,3,0,0,64,2,0,0,64,2,0,0,64,2,0,0,32,4,0,0,16,8,0,0,12,112,0,0,3,192,0},
  {0,3,192,0,0,6,96,0,0,12,48,0,0,8,16,0,0,8,16,0,0,8,48,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,60,0,0,8,16,0,0,15,252,0,0,12,48,0,0,24,24,0,0,48,12,0,0,96,6,0,0,64,2,0,0,64,2,0,0,64,3,0,0,192,3,0,0,64,2,0,0,64,2,0,0,64,2,0,0,32,4,0,0,16,8,0,0,12,112,0,0,3,192,0},
  {0,3,192,0,0,6,96,0,0,12,48,0,0,8,16,0,0,8,16,0,0,8,48,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,60,0,0,8,16,0,0,15,252,0,0,12,48,0,0,24,24,0,0,48,12,0,0,96,6,0,0,64,2,0,0,64,2,0,0,64,3,0,0,192,3,0,0,64,2,0,0,64,2,0,0,64,2,0,0,32,4,0,0,16,8,0,0,12,112,0,0,3,192,0},
  {0,3,192,0,0,6,96,0,0,4,16,0,0,12,16,0,0,12,16,0,0,12,16,0,0,12,30,0,0,12,16,0,0,8,60,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,16,0,0,8,48,0,0,8,60,0,0,8,16,0,0,12,60,0,0,15,240,0,0,24,24,0,0,48,12,0,0,96,4,0,0,64,2,0,0,64,2,0,0,128,2,0,0,192,2,0,0,192,2,0,0,64,2,0,0,64,6,0,0,32,4,0,0,48,8,0,0,12,112,0,0,3,192,0},
  {0,3,192,0,0,6,96,0,0,4,16,0,0,4,16,0,0,4,16,0,0,4,16,0,0,4,30,0,0,12,16,0,0,12,28,0,0,12,30,0,0,12,16,0,0,8,30,0,0,8,16,0,0,8,16,0,0,8,60,0,0,8,16,0,0,8,60,0,0,15,112,0,0,25,184,0,0,48,12,0,0,96,4,0,0,64,2,0,0,192,2,0,0,128,2,0,0,128,2,0,0,192,2,0,0,192,2,0,0,64,6,0,0,32,4,0,0,48,24,0,0,28,112,0,0,3,192,0},
  {0,3,224,0,0,6,112,0,0,4,16,0,0,4,16,0,0,4,16,0,0,4,16,0,0,4,30,0,0,4,16,0,0,12,24,0,0,12,30,0,0,12,16,0,0,12,30,0,0,8,16,0,0,8,16,0,0,8,60,0,0,8,16,0,0,8,60,0,0,12,48,0,0,31,240,0,0,32,8,0,0,64,4,0,0,64,2,0,0,128,2,0,0,128,2,0,0,128,2,0,0,192,2,0,0,192,2,0,0,64,6,0,0,32,4,0,0,48,24,0,0,28,112,0,0,3,192,0},
  {0,3,192,0,0,6,96,0,0,4,16,0,0,4,16,0,0,4,16,0,0,4,16,0,0,4,30,0,0,12,16,0,0,12,28,0,0,12,30,0,0,12,16,0,0,8,30,0,0,8,16,0,0,12,16,0,0,15,252,0,0,12,48,0,0,8,60,0,0,8,48,0,0,24,24,0,0,48,12,0,0,96,4,0,0,64,2,0,0,192,2,0,0,128,2,0,0,128,2,0,0,192,2,0,0,192,2,0,0,64,6,0,0,32,4,0,0,48,24,0,0,28,112,0,0,3,192,0},
  {0,3,192,0,0,6,96,0,0,4,16,0,0,12,16,0,0,12,16,0,0,12,16,0,0,12,30,0,0,13,240,0,0,14,124,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,16,0,0,8,48,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,48,0,0,24,24,0,0,48,12,0,0,96,4,0,0,64,2,0,0,64,2,0,0,128,2,0,0,192,2,0,0,192,2,0,0,64,2,0,0,64,6,0,0,32,4,0,0,48,8,0,0,12,112,0,0,3,192,0},
  {0,3,192,0,0,6,96,0,0,12,48,0,0,13,240,0,0,14,240,0,0,12,48,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,48,0,0,24,24,0,0,48,12,0,0,96,6,0,0,64,2,0,0,64,2,0,0,64,3,0,0,192,3,0,0,64,2,0,0,64,2,0,0,64,2,0,0,32,4,0,0,16,8,0,0,12,112,0,0,3,192,0},
  {0,3,192,0,0,6,96,0,0,12,48,0,0,15,240,0,0,12,48,0,0,8,48,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,48,0,0,24,24,0,0,48,12,0,0,96,6,0,0,64,2,0,0,64,2,0,0,64,3,0,0,192,3,0,0,64,2,0,0,64,2,0,0,64,2,0,0,32,4,0,0,16,8,0,0,12,112,0,0,3,192,0},
  {0,3,192,0,0,6,96,0,0,12,48,0,0,8,16,0,0,13,176,0,0,15,240,0,0,12,60,0,0,8,16,0,0,8,60,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,48,0,0,24,24,0,0,48,12,0,0,96,6,0,0,64,2,0,0,64,2,0,0,64,3,0,0,192,3,0,0,64,2,0,0,64,2,0,0,64,2,0,0,32,4,0,0,16,8,0,0,12,112,0,0,3,192,0},
  {0,3,192,0,0,6,96,0,0,12,48,0,0,8,16,0,0,8,16,0,0,13,176,0,0,15,252,0,0,8,16,0,0,8,60,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,48,0,0,24,24,0,0,48,12,0,0,96,6,0,0,64,2,0,0,64,2,0,0,64,3,0,0,192,3,0,0,64,2,0,0,64,2,0,0,64,2,0,0,32,4,0,0,16,8,0,0,12,112,0,0,3,192,0},
  {0,3,192,0,0,6,96,0,0,12,48,0,0,8,16,0,0,8,16,0,0,12,48,0,0,15,252,0,0,12,48,0,0,8,60,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,48,0,0,24,24,0,0,48,12,0,0,96,6,0,0,64,2,0,0,64,2,0,0,64,3,0,0,192,3,0,0,64,2,0,0,64,2,0,0,64,2,0,0,32,4,0,0,16,8,0,0,12,112,0,0,3,192,0},
  {0,3,192,0,0,6,96,0,0,12,48,0,0,8,16,0,0,8,16,0,0,12,48,0,0,15,252,0,0,12,48,0,0,8,60,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,60,0,0,8,16,0,0,8,60,0,0,8,48,0,0,24,24,0,0,48,12,0,0,96,6,0,0,64,2,0,0,64,2,0,0,64,3,0,0,192,3,0,0,64,2,0,0,64,2,0,0,64,2,0,0,32,4,0,0,16,8,0,0,12,112,0,0,3,192,0}
};

//==== Icon bật tắt data ====
const uint8_t PROGMEM dataFrames[][ (FRAME_WIDTH * FRAME_HEIGHT) / 8 ] = {
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,63,252,0,1,192,3,128,6,0,0,96,24,1,192,24,48,63,252,12,96,192,3,6,67,0,0,195,36,3,224,38,24,60,124,28,16,192,3,8,1,128,1,128,3,3,224,192,3,28,120,192,1,160,5,128,0,192,3,0,0,7,224,0,0,12,48,0,0,24,24,0,0,12,48,0,0,6,96,0,0,3,192,0,0,1,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,63,252,0,1,192,3,128,6,0,0,96,24,1,192,24,48,63,252,12,96,192,3,6,67,0,0,195,36,3,224,38,24,60,124,28,16,192,3,8,1,128,1,128,3,3,224,192,3,28,120,192,1,160,5,128,0,192,3,0,0,7,224,0,0,12,48,0,0,24,24,0,0,12,48,0,0,6,96,0,0,3,192,0,0,1,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,63,252,0,1,192,3,128,6,0,0,96,24,1,192,24,48,63,252,12,96,192,3,6,67,0,0,195,36,3,224,38,24,60,124,28,16,192,3,8,1,128,1,128,3,3,224,192,3,28,120,192,1,160,5,128,0,192,3,0,0,7,224,0,0,12,48,0,0,24,24,0,0,12,48,0,0,6,96,0,0,3,192,0,0,1,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,63,252,0,1,192,3,128,6,0,0,96,24,1,192,24,48,63,252,12,96,192,3,6,67,0,0,195,36,3,224,38,24,60,124,28,16,192,3,8,1,128,1,128,3,3,224,192,3,28,120,192,1,160,5,128,0,192,3,0,0,7,224,0,0,12,48,0,0,24,24,0,0,12,48,0,0,6,96,0,0,3,192,0,0,1,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,63,252,0,1,192,3,128,6,0,0,96,24,1,192,24,48,63,252,12,96,192,3,6,67,0,0,195,36,15,248,38,24,112,14,28,16,192,3,8,3,0,0,192,3,15,240,64,1,48,12,128,0,224,7,0,0,3,192,0,0,15,240,0,0,24,24,0,0,8,16,0,0,12,48,0,0,6,96,0,0,3,192,0,0,1,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,15,248,0,0,240,15,0,3,0,0,192,12,0,0,48,24,15,248,8,96,112,15,4,193,128,1,131,102,15,248,102,60,112,14,28,16,192,3,8,3,0,0,192,2,15,240,64,1,48,28,192,0,224,7,128,0,0,1,0,0,7,224,0,0,24,24,0,0,24,24,0,0,12,48,0,0,6,96,0,0,3,192,0,0,1,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,31,252,0,1,224,7,128,7,0,0,224,12,0,0,48,48,31,252,12,96,224,7,6,195,0,0,195,102,7,224,38,56,60,124,28,16,192,3,8,1,128,0,128,2,3,224,64,3,28,120,192,1,160,5,128,0,192,3,0,0,0,0,0,0,7,224,0,0,12,48,0,0,24,24,0,0,12,48,0,0,6,96,0,0,2,64,0,0,1,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,31,248,0,0,224,15,0,3,0,0,192,12,0,0,48,48,15,248,8,96,240,15,6,193,128,1,195,70,0,0,98,60,0,0,30,16,0,0,12,0,0,0,0,0,0,0,0,0,30,248,0,0,32,4,0,0,192,3,0,0,143,241,0,0,88,11,0,0,32,6,0,0,7,224,0,0,28,56,0,0,24,24,0,0,12,48,0,0,6,96,0,0,3,192,0,0,1,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,31,252,0,0,192,3,0,3,1,192,128,6,30,248,96,12,96,6,48,5,128,1,160,3,0,0,192,0,0,0,0,0,0,0,0,0,0,0,0,0,1,128,0,0,13,176,0,0,31,248,0,0,24,24,0,0,24,24,0,0,12,48,0,0,6,96,0,0,3,192,0,0,1,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,128,0,0,8,16,0,0,36,36,0,0,23,232,0,0,12,48,0,0,24,24,0,0,12,48,0,0,6,96,0,0,3,192,0,0,1,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,128,0,0,15,240,0,0,24,24,0,0,24,24,0,0,12,48,0,0,6,96,0,0,3,192,0,0,1,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,224,0,0,12,48,0,0,24,24,0,0,12,48,0,0,6,96,0,0,3,192,0,0,1,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,224,0,0,12,48,0,0,24,24,0,0,12,48,0,0,6,96,0,0,3,192,0,0,1,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,224,0,0,12,48,0,0,24,24,0,0,12,48,0,0,6,96,0,0,3,192,0,0,1,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,224,0,0,12,48,0,0,24,24,0,0,12,48,0,0,6,96,0,0,3,192,0,0,1,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,224,0,0,12,48,0,0,24,24,0,0,12,48,0,0,6,96,0,0,3,192,0,0,1,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,224,0,0,12,48,0,0,24,24,0,0,12,48,0,0,6,96,0,0,3,192,0,0,1,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,224,0,0,12,48,0,0,24,24,0,0,12,48,0,0,6,96,0,0,3,192,0,0,1,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,192,0,0,15,240,0,0,31,248,0,0,24,24,0,0,24,24,0,0,12,48,0,0,6,96,0,0,3,192,0,0,1,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,240,0,0,56,60,0,0,192,131,0,1,158,249,128,3,32,4,192,1,192,3,128,0,0,0,0,0,0,0,0,0,0,0,0,0,15,240,0,0,28,56,0,0,24,24,0,0,12,48,0,0,6,96,0,0,3,192,0,0,1,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,15,240,0,0,120,63,0,1,128,1,128,6,0,128,96,12,31,252,16,48,224,7,12,49,128,1,140,30,0,0,120,12,0,0,48,0,0,0,0,0,0,0,0,0,1,128,0,0,28,120,0,0,48,12,0,0,103,230,0,0,60,60,0,0,31,248,0,0,24,24,0,0,24,24,0,0,12,48,0,0,6,96,0,0,3,192,0,0,1,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,31,248,0,0,224,15,0,3,0,0,192,12,0,0,48,48,15,248,8,96,240,15,6,193,128,1,195,70,0,0,98,60,0,0,30,16,0,0,12,0,7,240,0,0,60,124,0,0,224,7,0,1,128,1,128,1,143,240,128,0,176,13,0,0,96,7,0,0,0,0,0,0,7,224,0,0,28,56,0,0,24,24,0,0,12,48,0,0,6,96,0,0,3,192,0,0,1,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,31,252,0,1,224,7,128,7,0,0,224,12,0,0,48,48,31,252,12,96,224,7,6,195,0,0,195,102,7,224,38,56,60,124,28,16,192,3,8,1,128,0,128,2,3,224,64,3,28,120,192,1,160,5,128,0,192,3,0,0,0,0,0,0,7,224,0,0,12,48,0,0,24,24,0,0,12,48,0,0,6,96,0,0,2,64,0,0,1,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,15,248,0,0,240,15,0,3,0,0,192,12,0,0,48,24,15,248,8,96,112,15,4,193,128,1,131,102,15,248,102,60,112,14,28,16,192,3,8,3,0,0,192,2,15,240,64,1,48,28,192,0,224,7,128,0,0,1,0,0,7,224,0,0,24,24,0,0,24,24,0,0,12,48,0,0,6,96,0,0,3,192,0,0,1,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,63,252,0,1,192,3,128,6,0,0,96,24,1,192,24,48,63,252,12,96,192,3,6,67,0,0,195,36,15,248,38,24,112,14,28,16,192,3,8,3,0,0,192,3,15,240,64,1,48,12,128,0,224,7,0,0,3,192,0,0,15,240,0,0,24,24,0,0,8,16,0,0,12,48,0,0,6,96,0,0,3,192,0,0,1,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,63,252,0,1,192,3,128,6,0,0,96,24,1,192,24,48,63,252,12,96,192,3,6,67,0,0,195,36,3,224,38,24,60,124,28,16,192,3,8,1,128,1,128,3,3,224,192,3,28,120,192,1,160,5,128,0,192,3,0,0,7,224,0,0,12,48,0,0,24,24,0,0,12,48,0,0,6,96,0,0,3,192,0,0,1,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,63,252,0,1,192,3,128,6,0,0,96,24,1,192,24,48,63,252,12,96,192,3,6,67,0,0,195,36,3,224,38,24,60,124,28,16,192,3,8,1,128,1,128,3,3,224,192,3,28,120,192,1,160,5,128,0,192,3,0,0,7,224,0,0,12,48,0,0,24,24,0,0,12,48,0,0,6,96,0,0,3,192,0,0,1,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,63,252,0,1,192,3,128,6,0,0,96,24,1,192,24,48,63,252,12,96,192,3,6,67,0,0,195,36,3,224,38,24,60,124,28,16,192,3,8,1,128,1,128,3,3,224,192,3,28,120,192,1,160,5,128,0,192,3,0,0,7,224,0,0,12,48,0,0,24,24,0,0,12,48,0,0,6,96,0,0,3,192,0,0,1,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0}
};


// ====================== Startup icon ======================
const uint8_t PROGMEM startupFrames[][ (FRAME_WIDTH * FRAME_HEIGHT) / 8 ] = {
  {0,0,0,0,0,1,128,0,0,17,136,0,0,97,134,0,1,129,129,128,3,1,128,64,6,1,128,32,12,1,128,16,8,1,128,24,16,1,128,8,16,1,128,12,32,1,128,4,32,1,128,4,32,1,128,4,32,1,128,4,96,1,128,6,96,0,0,6,96,0,0,6,32,0,0,4,32,0,0,4,32,0,0,4,48,0,0,12,16,0,0,8,24,0,0,24,12,0,0,48,4,0,0,96,3,0,0,192,1,128,1,128,0,96,6,0,0,63,252,0,0,3,128,0,0,0,0,0},
  {0,0,0,0,0,1,128,0,0,17,136,0,0,97,134,0,1,129,129,128,3,1,128,64,6,1,128,32,12,1,128,16,8,1,128,24,16,1,128,8,16,1,128,12,32,1,128,4,32,1,128,4,32,1,128,4,32,1,128,4,96,1,128,6,96,0,0,6,96,0,0,6,32,0,0,4,32,0,0,4,32,0,0,4,48,0,0,12,16,0,0,8,24,0,0,24,12,0,0,48,4,0,0,96,3,0,0,192,1,128,1,128,0,96,6,0,0,63,252,0,0,3,128,0,0,0,0,0},
  {0,0,0,0,0,1,128,0,0,17,136,0,0,97,134,0,1,129,129,128,3,1,128,64,6,1,128,32,12,1,128,16,8,1,128,24,16,1,128,8,16,1,128,12,32,1,128,4,32,1,128,4,32,1,128,4,32,1,128,4,96,1,128,6,96,0,0,6,96,0,0,6,32,0,0,4,32,0,0,4,32,0,0,4,48,0,0,12,16,0,0,8,24,0,0,24,12,0,0,48,4,0,0,96,3,0,0,192,1,128,1,128,0,96,6,0,0,63,252,0,0,3,128,0,0,0,0,0},
  {0,0,0,0,0,1,128,0,0,17,136,0,0,97,134,0,1,129,129,128,3,1,128,64,6,1,128,32,12,1,128,16,8,1,128,24,16,1,128,8,16,1,128,12,32,1,128,4,32,1,128,4,32,1,128,4,32,1,128,4,96,1,128,6,96,0,0,6,96,0,0,6,32,0,0,4,32,0,0,4,32,0,0,4,48,0,0,12,16,0,0,8,24,0,0,24,12,0,0,48,4,0,0,96,3,0,0,192,1,128,1,128,0,96,6,0,0,63,252,0,0,3,128,0,0,0,0,0},
  {0,0,0,0,0,1,128,0,0,1,136,0,0,1,134,0,0,1,129,128,0,1,128,64,0,1,128,32,8,1,128,16,8,1,128,24,16,1,128,8,48,1,128,12,32,1,128,4,32,1,128,4,32,1,128,4,32,1,128,4,96,1,128,6,96,0,0,6,96,0,0,6,32,0,0,4,32,0,0,4,32,0,0,4,48,0,0,12,16,0,0,8,24,0,0,24,12,0,0,48,4,0,0,96,3,0,0,192,1,128,1,128,0,96,6,0,0,63,252,0,0,3,128,0,0,0,0,0},
  {0,0,0,0,0,1,128,0,0,1,136,0,0,1,134,0,0,1,129,128,0,1,128,64,0,1,128,32,0,1,128,16,0,1,128,24,0,1,128,8,0,1,128,12,0,1,128,4,0,1,128,4,0,1,128,4,0,1,128,4,0,1,128,6,0,0,0,6,0,0,0,6,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,12,0,0,0,8,0,0,0,24,0,0,0,48,4,0,0,96,3,0,0,192,1,128,1,128,0,96,6,0,0,63,252,0,0,3,128,0,0,0,0,0},
  {0,0,0,0,0,1,128,0,0,1,136,0,0,1,134,0,0,1,129,128,0,1,128,192,0,1,128,96,0,1,128,48,0,1,128,16,0,1,128,8,0,1,128,8,0,1,128,4,0,1,128,4,0,1,128,4,0,1,128,4,0,1,128,6,0,0,0,6,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,12,0,0,0,8,0,0,0,24,0,0,0,48,0,0,0,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,1,128,0,0,1,136,0,0,1,134,0,0,1,129,128,0,1,128,64,0,1,128,32,0,1,128,16,0,1,128,0,0,1,128,0,0,1,128,0,0,1,128,0,0,1,128,0,0,1,128,0,0,1,128,0,0,1,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,1,128,0,0,1,128,0,0,1,128,0,0,1,128,0,0,1,128,0,0,1,128,0,0,1,128,0,0,1,128,0,0,1,128,0,0,1,128,0,0,1,128,0,0,1,128,0,0,1,128,0,0,1,128,0,0,1,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,128,0,0,1,128,0,0,1,128,0,0,1,128,0,0,1,128,0,0,1,128,0,0,1,128,0,0,1,128,0,0,1,128,0,0,1,128,0,0,1,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,128,0,0,1,128,0,0,1,128,0,0,1,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,16,0,0,0,96,0,0,1,128,0,0,3,0,0,0,6,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,48,0,0,0,96,0,0,1,128,0,0,3,0,0,0,6,0,0,0,12,0,0,0,8,0,0,0,16,0,0,0,16,0,0,0,32,0,0,0,32,0,0,0,32,0,0,0,32,0,0,0,96,0,0,0,96,0,0,0,96,0,0,0,32,0,0,0,32,0,0,0,32,0,0,0,48,0,0,0,16,0,0,0,24,0,0,0,12,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,16,0,0,0,96,0,0,1,128,0,0,3,0,0,0,6,0,0,0,12,0,0,0,8,0,0,0,16,0,0,0,16,0,0,0,32,0,0,0,32,0,0,0,32,0,0,0,32,0,0,0,96,0,0,0,96,0,0,0,96,0,0,0,32,0,0,0,32,0,0,0,32,0,0,0,48,0,0,0,16,0,0,0,24,0,0,0,12,0,0,0,4,0,0,96,3,0,0,192,1,128,1,128,0,96,7,0,0,63,252,0,0,3,128,0,0,0,0,0},
  {0,0,0,0,0,1,128,0,0,17,128,0,0,97,128,0,1,128,0,0,3,0,0,0,6,0,0,0,12,0,0,16,8,0,0,16,16,0,0,8,16,0,0,12,32,0,0,4,32,0,0,4,32,0,0,4,32,0,0,4,96,0,0,6,96,0,0,6,96,0,0,6,32,0,0,4,32,0,0,4,32,0,0,4,48,0,0,12,16,0,0,8,24,0,0,24,12,0,0,48,4,0,0,96,3,0,0,192,1,128,1,128,0,96,6,0,0,63,252,0,0,3,128,0,0,0,0,0},
  {0,0,0,0,0,1,128,0,0,17,136,0,0,97,134,0,1,129,129,128,3,1,128,64,6,1,128,32,12,0,0,16,8,0,0,24,16,0,0,8,16,0,0,12,32,0,0,4,32,0,0,4,32,0,0,4,32,0,0,4,96,0,0,6,96,0,0,6,96,0,0,6,32,0,0,4,32,0,0,4,32,0,0,4,48,0,0,12,16,0,0,8,24,0,0,24,12,0,0,48,4,0,0,96,3,0,0,192,1,128,1,128,0,96,6,0,0,63,252,0,0,3,128,0,0,0,0,0},
  {0,0,0,0,0,1,128,0,0,17,136,0,0,97,134,0,1,129,129,128,3,1,128,64,6,1,128,32,12,1,128,16,8,1,128,24,16,1,128,8,16,1,128,12,32,1,128,4,32,0,0,4,32,0,0,4,32,0,0,4,96,0,0,6,96,0,0,6,96,0,0,6,32,0,0,4,32,0,0,4,32,0,0,4,48,0,0,12,16,0,0,8,24,0,0,24,12,0,0,48,4,0,0,96,3,0,0,192,1,128,1,128,0,96,6,0,0,63,252,0,0,3,128,0,0,0,0,0},
  {0,0,0,0,0,1,128,0,0,17,136,0,0,97,134,0,1,129,129,128,3,1,128,64,6,1,128,32,12,1,128,16,8,1,128,24,16,1,128,8,16,1,128,12,32,1,128,4,32,1,128,4,32,1,128,4,32,1,128,4,96,0,0,6,96,0,0,6,96,0,0,6,32,0,0,4,32,0,0,4,32,0,0,4,48,0,0,12,16,0,0,8,24,0,0,24,12,0,0,48,4,0,0,96,3,0,0,192,1,128,1,128,0,96,6,0,0,63,252,0,0,3,128,0,0,0,0,0},
  {0,0,0,0,0,1,128,0,0,17,136,0,0,97,134,0,1,129,129,128,3,1,128,64,6,1,128,32,12,1,128,16,8,1,128,24,16,1,128,8,16,1,128,12,32,1,128,4,32,1,128,4,32,1,128,4,32,1,128,4,96,1,128,6,96,0,0,6,96,0,0,6,32,0,0,4,32,0,0,4,32,0,0,4,48,0,0,12,16,0,0,8,24,0,0,24,12,0,0,48,4,0,0,96,3,0,0,192,1,128,1,128,0,96,6,0,0,63,252,0,0,3,128,0,0,0,0,0},
  {0,0,0,0,0,1,128,0,0,17,136,0,0,97,134,0,1,129,129,128,3,1,128,64,6,1,128,32,12,1,128,16,8,1,128,24,16,1,128,8,16,1,128,12,32,1,128,4,32,1,128,4,32,1,128,4,32,1,128,4,96,1,128,6,96,0,0,6,96,0,0,6,32,0,0,4,32,0,0,4,32,0,0,4,48,0,0,12,16,0,0,8,24,0,0,24,12,0,0,48,4,0,0,96,3,0,0,192,1,128,1,128,0,96,6,0,0,63,252,0,0,3,128,0,0,0,0,0},
  {0,0,0,0,0,1,128,0,0,17,136,0,0,97,134,0,1,129,129,128,3,1,128,64,6,1,128,32,12,1,128,16,8,1,128,24,16,1,128,8,16,1,128,12,32,1,128,4,32,1,128,4,32,1,128,4,32,1,128,4,96,1,128,6,96,0,0,6,96,0,0,6,32,0,0,4,32,0,0,4,32,0,0,4,48,0,0,12,16,0,0,8,24,0,0,24,12,0,0,48,4,0,0,96,3,0,0,192,1,128,1,128,0,96,6,0,0,63,252,0,0,3,128,0,0,0,0,0}
};

#else
// Khi tắt animation, để mảng giả (dummy) có 1 khung 1x1 byte để code vẫn link được
// Đồng thời trong code, nếu USE_ANIM=0 sẽ không gọi drawBitmap các frame này.
const uint8_t PROGMEM coldFrames[][1]    = { {0x00} };
const uint8_t PROGMEM normalFrames[][1]  = { {0x00} };
const uint8_t PROGMEM hotFrames[][1]     = { {0x00} };
const uint8_t PROGMEM humidityFrames[][1]= { {0x00} };
#endif

// ====================== BLYNK FUNCTIONS ======================

// ----- Kết nối WiFi -----
void connectToWiFi() {
  Serial.println("\n=== Connecting to WiFi ===");
  Serial.print("SSID: ");
  Serial.println(WIFI_SSID);

  display.println("Connecting WiFi...");
  display.display();

  WiFi.begin(WIFI_SSID, WIFI_PASSWORD);

  int attempts = 0;
  while (WiFi.status() != WL_CONNECTED && attempts < 20) {
    delay(500);
    Serial.print(".");
    display.print(".");
    display.display();
    attempts++;
  }

  if (WiFi.status() == WL_CONNECTED) {
    Serial.println("\n✓ WiFi connected!");
    Serial.print("IP Address: ");
    Serial.println(WiFi.localIP());
    Serial.print("Signal Strength (RSSI): ");
    Serial.print(WiFi.RSSI());
    Serial.println(" dBm");

    display.println(" OK");
    display.display();
    delay(500);
  } else {
    Serial.println("\n✗ WiFi connection failed!");
    Serial.println("Check your SSID and password at the top of this file");

    display.println(" FAIL");
    display.display();
    delay(1000);
  }
}

// ----- Kết nối Blynk -----
void connectToBlynk() {
  Serial.println("\n=== Connecting to Blynk ===");
  Serial.print("Template ID: ");
  Serial.println(BLYNK_TEMPLATE_ID);

  display.println("Connecting Blynk...");
  display.display();

  Blynk.config(BLYNK_AUTH_TOKEN);

  int attempts = 0;
  while (!Blynk.connect() && attempts < 10) {
    Serial.print(".");
    display.print(".");
    display.display();
    delay(1000);
    attempts++;
  }

  if (Blynk.connected()) {
    Serial.println("\n✓ Blynk connected!");
    Serial.println("Dashboard ready to receive data");

    display.println(" OK");
    display.display();
    delay(500);
  } else {
    Serial.println("\n✗ Blynk connection failed!");
    Serial.println("Check your AUTH_TOKEN at the top of this file");

    display.println(" FAIL");
    display.display();
    delay(1000);
  }
}

// ----- Khởi tạo Blynk -----
void initBlynk() {
  connectToWiFi();
  if (WiFi.status() == WL_CONNECTED) {
    connectToBlynk();
  } else {
    Serial.println("✗ Cannot connect to Blynk without WiFi");
  }
}

// ----- Gửi dữ liệu lên Blynk -----
void sendDataToBlynk(float temperature, float humidity, int rainLevel,
                     String rainStatus, float pressure, int digitalVal) {
  if (!Blynk.connected()) {
    Serial.println("⚠ Blynk disconnected. Attempting to reconnect...");
    connectToBlynk();
    return;
  }

  Blynk.virtualWrite(VPIN_TEMPERATURE, (int)temperature);
  Blynk.virtualWrite(VPIN_HUMIDITY, (int)humidity);
  Blynk.virtualWrite(VPIN_RAIN_LEVEL, rainLevel);
  Blynk.virtualWrite(VPIN_RAIN_STATUS, rainStatus);
  Blynk.virtualWrite(VPIN_PRESSURE, (int)pressure);
  Blynk.virtualWrite(VPIN_DIGITAL, digitalVal);
  Blynk.virtualWrite(VPIN_WIND_SPEED, wind_speed);

  Serial.println("\n📤 Data sent to Blynk:");
  Serial.printf("  V0 (Temp): %d°C\n", (int)temperature);
  Serial.printf("  V1 (Humidity): %d%%\n", (int)humidity);
  Serial.printf("  V2 (Rain Level): %d%%\n", rainLevel);
  Serial.printf("  V3 (Rain Status): %s\n", rainStatus.c_str());
  Serial.printf("  V4 (Pressure): %d hPa\n", (int)pressure);
  Serial.printf("  V5 (Digital): %d\n", digitalVal);
  Serial.printf("  V7 (Wind Speed): %.1f km/h\n", wind_speed);
}

// ----- Xử lý Blynk trong loop -----
void handleBlynk(float temperature, float humidity, int rainLevel,
                 String rainStatus, float pressure, int digitalVal) {
  Blynk.run();

  unsigned long currentMillis = millis();
  if (currentMillis - lastBlynkUpdate >= BLYNK_UPDATE_INTERVAL) {
    lastBlynkUpdate = currentMillis;

    // Chỉ gửi dữ liệu nếu được bật
    if (blynkDataEnabled) {
      sendDataToBlynk(temperature, humidity, rainLevel, rainStatus, pressure, digitalVal);
    }
  }
}

// ----- Blynk Events -----
BLYNK_CONNECTED() {
  Serial.println("🟢 Blynk Connected Event");

  // Sync trạng thái V6 từ server (giữ trạng thái khi reconnect)
  // Không gửi lên để tránh trigger BLYNK_WRITE và hiện page 3 không mong muốn
  Blynk.syncVirtual(VPIN_DATA_ENABLE);
}

BLYNK_DISCONNECTED() {
  Serial.println("🔴 Blynk Disconnected Event");
}

// ----- Callback khi bật/tắt switch V6 -----
BLYNK_WRITE(VPIN_DATA_ENABLE) {
  int value = param.asInt();  // Nhận giá trị 0 hoặc 1
  blynkDataEnabled = (value == 1);

  if (blynkDataEnabled) {
    Serial.println("✅ Data sending ENABLED");
  } else {
    Serial.println("⛔ Data sending DISABLED");
  }

  // Chỉ hiển thị trang 3 nếu KHÔNG phải lần sync đầu tiên khi boot
  if (!blynkFirstSync) {
    showPage3 = true;
    page3ShowTime = millis();
  } else {
    // Lần đầu tiên sync từ server, chỉ cập nhật trạng thái, không hiện page 3
    blynkFirstSync = false;
    Serial.println("📥 Initial sync complete, page 3 not shown in loop");
  }
}

// ====================== MONGODB BACKEND FUNCTIONS ======================

unsigned long lastBackendSend = 0;
#define BACKEND_SEND_INTERVAL 5000  // Gửi dữ liệu mỗi 5 giây

void sendDataToBackend(float temperature, float humidity, float pressure,
                        int rain_level, float wind_speed, String rain_status) {
  unsigned long now = millis();

  // Chỉ gửi mỗi 5 giây để tránh spam
  if (now - lastBackendSend < BACKEND_SEND_INTERVAL) {
    return;
  }

  lastBackendSend = now;

  HTTPClient http;
  String url = String(BACKEND_SERVER_URL) + "/api/weather";

  http.begin(url);
  http.addHeader("Content-Type", "application/json");
  http.addHeader("Authorization", "Bearer " + String(DEVICE_TOKEN));

  // Tạo JSON payload
  StaticJsonDocument<256> doc;
  doc["temperature"] = temperature;
  doc["humidity"] = humidity;
  doc["pressure"] = pressure;
  doc["rain_level"] = rain_level;
  doc["wind_speed"] = wind_speed;
  doc["rain_status"] = rain_status;

  String payload;
  serializeJson(doc, payload);

  Serial.println("\n📡 Sending data to MongoDB backend...");
  Serial.println("URL: " + url);
  Serial.println("Payload: " + payload);

  int httpCode = http.POST(payload);

  if (httpCode == 200 || httpCode == 201) {
    Serial.println("✅ Data saved to MongoDB successfully!");
    String response = http.getString();
    Serial.println("Response: " + response);
  } else {
    Serial.print("❌ Error sending to MongoDB: HTTP ");
    Serial.println(httpCode);
    if (httpCode > 0) {
      Serial.println("Response: " + http.getString());
    }
  }

  http.end();
}

// ====================== WIND SPEED FUNCTIONS ======================
// Interrupt handler cho Hall sensor (gọi khi phát hiện nam châm)
void IRAM_ATTR wind_pulse_isr() {
  wind_pulse_count++;
}

// Hàm tính tốc độ gió từ số xung Hall sensor
void calculateWindSpeed() {
  unsigned long current_time = millis();
  unsigned long elapsed_time = current_time - last_wind_calc_time;

  if (elapsed_time >= WIND_CALC_INTERVAL) {
    // Lấy số xung và reset ngay để tránh mất xung
    noInterrupts();
    unsigned long pulses = wind_pulse_count;
    wind_pulse_count = 0;
    interrupts();

    // Tính thời gian (giây)
    float time_seconds = elapsed_time / 1000.0;

    // Tính số vòng quay (1 nam châm = 1 xung/vòng)
    float rotations = (float)pulses / WIND_MAGNETS;

    // Tính số vòng quay/giây (RPS)
    float rps = rotations / time_seconds;

    // Chu vi quỹ đạo nam châm (mét)
    float circumference = 2.0 * PI * WIND_RADIUS;  // = 0.1508m

    // Tốc độ (m/s) = RPS × Chu vi
    float speed_ms = rps * circumference;

    // Chuyển sang km/h
    wind_speed = speed_ms * 3.6;

    last_wind_calc_time = current_time;
  }
}

// ====================== SETUP ======================
void setup() {
  Serial.begin(115200);
  delay(300);

  Serial.println("\n\n=== ESP32 + OLED + Weather Display ===");

  Wire.begin(SDA_PIN, SCL_PIN);
  delay(200);

  pinMode(RAIN_DO, INPUT);
  analogSetWidth(12);

  // Hall sensor setup
  pinMode(HALL_PIN, INPUT_PULLUP);
  attachInterrupt(digitalPinToInterrupt(HALL_PIN), wind_pulse_isr, FALLING);
  last_wind_calc_time = millis();
  Serial.println("✓ Hall sensor initialized on GPIO 27");

  // OLED
  Serial.println("Initializing OLED...");
  if (!display.begin(SSD1306_SWITCHCAPVCC, OLED_ADDR)) {
    Serial.println("✗ OLED not found!");
    while (1) { delay(10); }
  }
  Serial.println("✓ OLED found");
  display.clearDisplay();
  display.setTextSize(1);
  display.setTextColor(SSD1306_WHITE);
  display.setCursor(0, 0);
  display.println("Init OLED... OK");
  display.display();
  delay(500);

  // AHT20
  Serial.println("Initializing AHT20...");
  display.println("Init AHT20...");
  display.display();
  if (!aht20_begin()) {
    Serial.println("✗ AHT20 not found!");
    display.println("AHT20 ERROR!");
    display.display();
    while (1) { delay(10); }
  }
  Serial.println("✓ AHT20 found");
  display.println("AHT20... OK");
  display.display();
  delay(500);

  // BMP280
  Serial.println("Initializing BMP280...");
  display.println("Init BMP280...");
  display.display();
  if (!bmp280.begin(0x77)) {
    Serial.println("✗ BMP280 not found!");
    display.println("BMP280 FAIL!");
    display.display();
  } else {
    Serial.println("✓ BMP280 found");
    display.println("BMP280... OK");
    display.display();
    bmp280.setSampling(
      Adafruit_BMP280::MODE_NORMAL,
      Adafruit_BMP280::SAMPLING_X2,   // Temp oversampling
      Adafruit_BMP280::SAMPLING_X16,  // Pressure oversampling
      Adafruit_BMP280::FILTER_X16,
      Adafruit_BMP280::STANDBY_MS_500
    );
  }
  delay(500);

  // ===== KHỞI TẠO BLYNK =====
  // Kết nối WiFi và Blynk
  initBlynk();

  // Đợi và chạy Blynk.run() để xử lý callbacks (sync từ server)
  Serial.println("⏳ Waiting for Blynk to sync...");
  for (int i = 0; i < 20; i++) {
    Blynk.run();
    delay(100);  // Tổng 2 giây, nhưng cho phép Blynk xử lý callbacks
  }
  Serial.print("📊 After sync, blynkDataEnabled = ");
  Serial.println(blynkDataEnabled ? "ENABLED" : "DISABLED");

  // ===== KHỞI TẠO WEB SERVER =====
  setupSPIFFS();
  setupWebServer();

  // ===== STARTUP ANIMATION =====
  // Hiển thị startup animation ở giữa màn hình
  display.clearDisplay();
  int iconX = (128 - FRAME_WIDTH) / 2;  // Căn giữa theo chiều ngang
  int iconY = (64 - FRAME_HEIGHT) / 2;  // Căn giữa theo chiều dọc

  // Chạy qua tất cả các frame của startup animation
  int numFrames = COUNT_OF(startupFrames);
  for (int i = 0; i < numFrames; i++) {
    display.clearDisplay();
    display.drawBitmap(iconX, iconY, startupFrames[i], FRAME_WIDTH, FRAME_HEIGHT, SSD1306_WHITE);
    display.display();
    delay(100);  // 100ms mỗi frame
  }

  delay(500);  // Dừng lại 0.5s sau animation cuối

  // ===== HIỂN THỊ PAGE 3 SAU STARTUP (với animation) =====
  // Hiển thị trạng thái data stream ngay sau startup với animation
  Serial.print("📺 Displaying Page 3 with status: ");
  Serial.println(blynkDataEnabled ? "ENABLED" : "DISABLED");
  const char* status = blynkDataEnabled ? "ENABLED" : "DISABLED";
  int numDataFrames = COUNT_OF(dataFrames);
  unsigned long page3StartTime = millis();
  int frame = 0;

  // Hiển thị page 3 trong 3 giây với animation
  while (millis() - page3StartTime < 3000) {
    display.clearDisplay();
    display.setTextSize(1);
    display.setTextColor(SSD1306_WHITE);

    // Tiêu đề "DATA STREAM" căn giữa
    const char* title = "DATA STREAM";
    int titleWidth = strlen(title) * 6;
    int titleX = (128 - titleWidth) / 2;
    display.setCursor(titleX, 0);
    display.println(title);

    // Gạch ngang
    display.drawLine(0, 10, 128, 10, SSD1306_WHITE);

    // Icon animation ở giữa
    display.drawBitmap(iconX, 16, dataFrames[frame % numDataFrames], FRAME_WIDTH, FRAME_HEIGHT, SSD1306_WHITE);

    // Status căn giữa
    int statusWidth = strlen(status) * 6;
    int statusX = (128 - statusWidth) / 2;
    display.setCursor(statusX, 52);
    display.println(status);

    display.display();
    delay(100);  // 100ms mỗi frame
    frame++;
  }

  // Reset timing để trang 1 hiển thị đầu tiên sau setup
  lastPageChange = millis();

  Serial.println("\nSetup complete!");
}

// ====================== LOOP ======================
void loop() {
  unsigned long now = millis();

  // Handle web server requests
  server.handleClient();

  // Đọc AHT20 (non-blocking với interval)
  aht20_read();

  // Đọc BMP280 pressure
  pressure = bmp280.readPressure() / 100.0F; // hPa

  // Đọc rain sensor mỗi 200ms
  if (now - lastRainRead >= RAIN_READ_INTERVAL) {
    rain_analog = analogRead(RAIN_AO);
    rain_digital = digitalRead(RAIN_DO);
    rain_level_percent = map(rain_analog, 4095, 0, 0, 100);
    detectRain(rain_analog, rain_digital, aht20_humidity, pressure);
    lastRainRead = now;
  }

  // Tính tốc độ gió
  calculateWindSpeed();

  updateAnimationFrames();

  // Kiểm tra nếu đang hiện trang 3 và đã hết thời gian
  if (showPage3 && (now - page3ShowTime >= PAGE3_DISPLAY_DURATION)) {
    showPage3 = false;  // Tắt trang 3, quay lại chu kỳ bình thường
  }

  // Auto-rotate trang 0-1 (chỉ khi không hiện trang 3)
  if (!showPage3 && (now - lastPageChange >= PAGE_INTERVAL)) {
    currentPage = (currentPage + 1) % 2;  // Chỉ xoay vòng 2 trang
    lastPageChange = now;
  }

  display.clearDisplay();
  display.setTextSize(1);
  display.setTextColor(SSD1306_WHITE);

  // Ưu tiên hiện trang 3 nếu được yêu cầu
  if (showPage3) {
    displayPage3();
  } else if (currentPage == 0) {
    displayPage1();
  } else {
    displayPage2();
  }

  display.display();

  Serial.print("Temp: ");
  Serial.print(aht20_temp, 1);
  Serial.print("°C | Humidity: ");
  Serial.print(aht20_humidity, 1);
  Serial.print("% | Rain: ");
  Serial.print(rain_level_percent);
  Serial.print("% | Status: ");
  Serial.println(rain_status);

  // ===== XỬ LÝ BLYNK =====
  // Gửi dữ liệu lên Blynk dashboard (mỗi 2 giây)
  handleBlynk(
    aht20_temp,           // V0: Nhiệt độ (°C)
    aht20_humidity,       // V1: Độ ẩm (%)
    rain_level_percent,   // V2: Mức mưa (%)
    rain_status,          // V3: Trạng thái mưa (String)
    pressure,             // V4: Áp suất (hPa)
    rain_digital          // V5: Digital value (0 hoặc 1)
  );

  // ===== GỬI DỮ LIỆU LÊN MONGODB =====
  // Gửi dữ liệu lên backend để lưu vào MongoDB (mỗi 5 giây)
  sendDataToBackend(
    aht20_temp,           // Nhiệt độ (°C)
    aht20_humidity,       // Độ ẩm (%)
    pressure,             // Áp suất (hPa)
    rain_level_percent,   // Mức mưa (%)
    wind_speed,           // Tốc độ gió (km/h)
    rain_status           // Trạng thái mưa (String)
  );

  // Không dùng delay() nữa để animation chạy mượt mà
}

// ====================== AHT20 ======================
bool aht20_begin() {
  Wire.beginTransmission(AHT20_ADDR);
  if (Wire.endTransmission() == 0) {
    delay(100);
    return true;
  }
  return false;
}

void aht20_read() {
  unsigned long now = millis();

  // Nếu chưa trigger hoặc đã qua thời gian đọc
  if (!sensorReadInProgress) {
    // Chỉ trigger nếu đã đủ interval từ lần đọc trước
    if (now - lastSensorRead >= SENSOR_READ_INTERVAL) {
      // Trigger measurement
      Wire.beginTransmission(AHT20_ADDR);
      Wire.write(0xAC);
      Wire.write(0x33);
      Wire.write(0x00);
      Wire.endTransmission();

      sensorReadInProgress = true;
      sensorTriggerTime = now;
    }
  } else {
    // Đợi 80ms sau khi trigger mới đọc data
    if (now - sensorTriggerTime >= 80) {
      Wire.requestFrom(AHT20_ADDR, 6);
      if (Wire.available() == 6) {
        uint8_t data[6];
        for (int i = 0; i < 6; i++) data[i] = Wire.read();

        if ((data[0] & 0x80) == 0) {
          uint32_t temp_raw = ((data[3] & 0x0F) << 16) | (data[4] << 8) | data[5];
          aht20_temp = temp_raw / 1048576.0 * 200.0 - 50.0;

          uint32_t humidity_raw = ((uint32_t)data[1] << 12) | ((uint32_t)data[2] << 4) | ((data[3] >> 4) & 0x0F);
          aht20_humidity = humidity_raw / 1048576.0 * 100.0;
        }
      }

      sensorReadInProgress = false;
      lastSensorRead = now;
    }
  }
}

// ====================== RAIN LOGIC ======================
void detectRain(int analog, int digital, float humidity, float pressure) {
  rain_status = "DRY";

  // Ưu tiên 1: Phát hiện mưa thực tế (sensor)
  // Ngưỡng: analog < 2400 = rain level > 41% (hợp lý với mưa thật)
  if (digital == HIGH || analog < 2400) {
    rain_status = "RAINING";
  }
  // Ưu tiên 2: Bề mặt ẩm ướt nhẹ
  // Ngưỡng: analog < 3200 = rain level 20-41% (ướt nhưng chưa mưa)
  else if (analog < 3200) {
    rain_status = "MOIST";
  }
  // Ưu tiên 3: Dự đoán sắp mưa (điều kiện khí hậu)
  else if (humidity > 85 || pressure < 1010) {
    rain_status = "LIKELY";
  }
  // Ưu tiên 4: Độ ẩm cao (không khí)
  else if (humidity > 70) {
    rain_status = "HUMID";
  }
  // Còn lại: Khô ráo (analog > 3200, rain level < 20%)
}

// ====================== ANIMATION STATE ======================
void updateAnimationFrames() {
  if (millis() - lastFrameUpdate > FRAME_DELAY) {
    tempAnimFrame = (tempAnimFrame + 1);
    humidityAnimFrame = (humidityAnimFrame + 1);
    dataAnimFrame = (dataAnimFrame + 1);
    lastFrameUpdate = millis();
  }
}

// Lấy frame nhiệt độ theo ngưỡng (lạnh/bình thường/nóng).
// Nếu USE_ANIM=0, hàm vẫn trả về con trỏ hợp lệ nhưng code hiển thị sẽ bỏ qua.
const uint8_t* getTempFrame() {
#if USE_ANIM
  if (aht20_temp < 10) {
    return coldFrames[tempAnimFrame % COUNT_OF(coldFrames)];
  } else if (aht20_temp <= 30) {
    return normalFrames[tempAnimFrame % COUNT_OF(normalFrames)];
  } else {
    return hotFrames[tempAnimFrame % COUNT_OF(hotFrames)];
  }
#else
  // Animation tắt: trả về dummy (không dùng)
  return coldFrames[0];
#endif
}

// ====================== HIỂN THỊ ======================
void displayPage1() {
  // Label nhiệt độ
  display.setTextSize(1);
  display.setCursor(0, 0);
  display.println("Temperature:");

  // Giá trị nhiệt độ
  display.setCursor(0, 10);
  display.setTextSize(2);
  display.printf("%.1f", aht20_temp);
  display.setTextSize(1);
  display.print("C");

#if USE_ANIM
  // Icon nhiệt độ (bên phải)
  display.drawBitmap(80, 0, getTempFrame(), FRAME_WIDTH, FRAME_HEIGHT, SSD1306_WHITE);
#else
  // Khi tắt animation: vẽ khung vuông đơn giản để giữ layout
  display.drawRect(80, 0, FRAME_WIDTH, FRAME_HEIGHT, SSD1306_WHITE);
  display.setCursor(86, 12);
  display.print("TEMP");
#endif

  // Label độ ẩm
  display.setCursor(0, 32);
  display.setTextSize(1);
  display.println("Humidity:");

  // Giá trị độ ẩm
  display.setCursor(0, 42);
  display.setTextSize(2);
  display.printf("%.0f", aht20_humidity);
  display.setTextSize(1);
  display.print("%");

#if USE_ANIM
  // Icon độ ẩm (bên phải)
  display.drawBitmap(
    80, 30,
    humidityFrames[humidityAnimFrame % COUNT_OF(humidityFrames)],
    FRAME_WIDTH, FRAME_HEIGHT,
    SSD1306_WHITE
  );
#else
  // Khi tắt animation: vẽ khung vuông đơn giản
  display.drawRect(80, 30, FRAME_WIDTH, FRAME_HEIGHT, SSD1306_WHITE);
  display.setCursor(86, 44);
  display.print("HUM");
#endif
}

void displayPage2() {
  // Tiêu đề
  display.setTextSize(1);
  display.setCursor(0, 0);
  display.println("WEATHER DATA");

  // Gạch ngang
  display.drawLine(0, 10, 128, 10, SSD1306_WHITE);

  // Wind Speed (tốc độ gió)
  display.setCursor(0, 14);
  display.print("Wind: ");
  display.print(wind_speed, 1);
  display.println(" km/h");

  // Rain Status
  display.setCursor(0, 24);
  display.print("Rain: ");
  display.println(rain_status);

  // Rain Level
  display.setCursor(0, 32);
  display.print("Rain Lv: ");
  display.print(rain_level_percent);
  display.println("%");

  // Pressure
  display.setCursor(0, 42);
  display.print("Pressure: ");
  display.print(pressure, 0);
  display.println(" hPa");

  // Weather status text
  display.setCursor(0, 52);
  if (rain_status == "RAINING") {
    display.println("IT'S RAINING!");
  } else if (rain_status == "MOIST") {
    display.println("Ground is wet");
  } else if (wind_speed > 20) {
    display.println("Windy!");
  } else {
    display.println("All clear");
  }
}

void displayPage3() {
  // Tiêu đề "DATA STREAM" căn giữa
  display.setTextSize(1);
  const char* title = "DATA STREAM";
  int titleWidth = strlen(title) * 6;  // Font mặc định 6px/char
  int titleX = (128 - titleWidth) / 2;
  display.setCursor(titleX, 0);
  display.println(title);

  // Gạch ngang
  display.drawLine(0, 10, 128, 10, SSD1306_WHITE);

#if USE_ANIM
  // Icon animation căn giữa
  int iconX = (128 - FRAME_WIDTH) / 2;  // (128-32)/2 = 48
  int iconY = 16;  // Y position để có khoảng trống phía trên và dưới
  display.drawBitmap(
    iconX, iconY,
    dataFrames[dataAnimFrame % COUNT_OF(dataFrames)],
    FRAME_WIDTH, FRAME_HEIGHT,
    SSD1306_WHITE
  );
#else
  // Khi tắt animation: vẽ khung vuông
  int iconX = (128 - FRAME_WIDTH) / 2;
  int iconY = 16;
  display.drawRect(iconX, iconY, FRAME_WIDTH, FRAME_HEIGHT, SSD1306_WHITE);
  display.setCursor(iconX + 4, iconY + 12);
  display.print("DATA");
#endif

  // Status "ENABLED" hoặc "DISABLED" căn giữa dưới icon
  display.setTextSize(1);
  const char* status = blynkDataEnabled ? "ENABLED" : "DISABLED";
  int statusWidth = strlen(status) * 6;
  int statusX = (128 - statusWidth) / 2;
  display.setCursor(statusX, 52);
  display.println(status);
}

// ====================== WEB SERVER FUNCTIONS ======================

void setupSPIFFS() {
  Serial.println("📁 Mounting SPIFFS...");
  if (!SPIFFS.begin(true)) {
    Serial.println("✗ SPIFFS Mount Failed");
    return;
  }
  Serial.println("✓ SPIFFS Mounted Successfully");

  // List files
  Serial.println("📂 Files in SPIFFS:");
  File root = SPIFFS.open("/");
  if (!root) {
    Serial.println("  ✗ Failed to open root directory");
    return;
  }
  if (!root.isDirectory()) {
    Serial.println("  ✗ Root is not a directory");
    return;
  }

  File file = root.openNextFile();
  int fileCount = 0;
  while (file) {
    if (!file.isDirectory()) {
      Serial.print("  FILE: ");
      Serial.print(file.name());
      Serial.print("  SIZE: ");
      Serial.println(file.size());
      fileCount++;
    }
    file.close();
    file = root.openNextFile();
  }

  if (fileCount == 0) {
    Serial.println("  ⚠️ No files found! SPIFFS may be empty.");
    Serial.println("  💡 Try: Tools → Partition Scheme → 'Default 4MB with spiffs'");
  } else {
    Serial.printf("  ✓ Total files: %d\n", fileCount);
  }
  root.close();
}

void setupWebServer() {
  // Serve static files from SPIFFS
  server.on("/", HTTP_GET, []() {
    Serial.println("📥 Request: /");
    File file = SPIFFS.open("/index.html", "r");
    if (!file) {
      Serial.println("  ✗ /index.html not found!");
      server.send(404, "text/plain", "index.html not found in SPIFFS");
      return;
    }
    Serial.println("  ✓ Serving /index.html");
    server.streamFile(file, "text/html");
    file.close();
  });

  server.on("/style.css", HTTP_GET, []() {
    File file = SPIFFS.open("/style.css", "r");
    if (!file) {
      server.send(404, "text/plain", "File not found");
      return;
    }
    server.streamFile(file, "text/css");
    file.close();
  });

  server.on("/app.js", HTTP_GET, []() {
    File file = SPIFFS.open("/app.js", "r");
    if (!file) {
      server.send(404, "text/plain", "File not found");
      return;
    }
    server.streamFile(file, "application/javascript");
    file.close();
  });

  // API endpoint for weather data
  server.on("/api/weather", HTTP_GET, []() {
    String json = getWeatherJSON();
    server.send(200, "application/json", json);
  });

  // API endpoint for firmware version
  server.on("/api/version", HTTP_GET, []() {
    String json = "{\"version\":\"" + String(FIRMWARE_VERSION) + "\"}";
    server.send(200, "application/json", json);
  });

  // OTA Update endpoint
  server.on("/update", HTTP_POST, []() {
    // Sau khi upload xong
    if (Update.hasError()) {
      server.send(500, "text/plain", "Update failed: " + String(Update.errorString()));
    } else {
      server.send(200, "text/plain", "Update successful! Rebooting...");
      delay(1000);
      ESP.restart();
    }
  }, []() {
    // Xử lý upload từng chunk
    HTTPUpload& upload = server.upload();

    if (upload.status == UPLOAD_FILE_START) {
      Serial.printf("OTA Update: %s\n", upload.filename.c_str());
      if (!Update.begin(UPDATE_SIZE_UNKNOWN)) {
        Update.printError(Serial);
      }
    } else if (upload.status == UPLOAD_FILE_WRITE) {
      if (Update.write(upload.buf, upload.currentSize) != upload.currentSize) {
        Update.printError(Serial);
      }
    } else if (upload.status == UPLOAD_FILE_END) {
      if (Update.end(true)) {
        Serial.printf("OTA Update Success: %u bytes\n", upload.totalSize);
      } else {
        Update.printError(Serial);
      }
    }
  });

  // 404 handler
  server.onNotFound([]() {
    server.send(404, "text/plain", "Not found");
  });

  server.begin();
  Serial.println("✓ Web Server started on port 80");
  Serial.print("✓ Access web interface at: http://");
  Serial.println(WiFi.localIP());
}

String getWeatherJSON() {
  StaticJsonDocument<256> doc;

  doc["temperature"] = round(aht20_temp * 10) / 10.0;
  doc["humidity"] = round(aht20_humidity);
  doc["rain_level"] = rain_level_percent;
  doc["rain_status"] = rain_status;
  doc["pressure"] = round(pressure);
  doc["wind_speed"] = round(wind_speed * 10) / 10.0;
  doc["digital"] = rain_digital;

  String output;
  serializeJson(doc, output);
  return output;
}
